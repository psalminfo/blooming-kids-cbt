<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta http-equiv="X-Content-Type-Options" content="nosniff" />
    <meta name="referrer" content="strict-origin-when-cross-origin" />
    <title>Parent Portal ‚Äî Blooming Kids House</title>

    <!-- Fonts (tutor design: Plus Jakarta Sans) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" href="favicon.ico" />

    <!-- Firebase compat SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-storage-compat.js"></script>

    <!-- Firebase Compat Bridge -->
    <script>
    (function () {
        var hostname = window.location.hostname;
        var isDev = hostname === 'localhost' || hostname === '127.0.0.1' || hostname.includes('bkhdevelop.netlify.app');
        var mainConfig = { apiKey: 'AIzaSyD1lJhsWMMs_qerLBSzk7wKhjLyI_11RJg', authDomain: 'bloomingkidsassessment.firebaseapp.com', projectId: 'bloomingkidsassessment', storageBucket: 'bloomingkidsassessment.appspot.com', messagingSenderId: '238975054977', appId: '1:238975054977:web:87c70b4db044998a204980' };
        var devConfig  = { apiKey: 'AIzaSyAu36oLPNsk0TPKVIwCzEHe9oOtJ7cZQXA', authDomain: 'blooming-kids-dev.firebaseapp.com', projectId: 'blooming-kids-dev', storageBucket: 'blooming-kids-dev.firebasestorage.app', messagingSenderId: '336022609689', appId: '1:336022609689:web:ad5a0a74dcac011f21ef88' };
        var config = isDev ? devConfig : mainConfig;
        window.firebaseConfig = config;
        var APP_NAME = 'parent-portal';
        var app;
        try { app = firebase.app(APP_NAME); } catch (e) { app = firebase.initializeApp(config, APP_NAME); }
        var authInst = firebase.auth(app);
        authInst.setPersistence(firebase.auth.Auth.Persistence.SESSION).catch(function(err){ console.warn('Auth persistence:', err.message); });
        window.db      = firebase.firestore(app);
        window.auth    = authInst;
        window.storage = firebase.storage(app);
        console.log('Parent portal bridge ready |', isDev ? 'DEV' : 'PROD');
    })();
    </script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/libphonenumber-js@1.9.6/bundle/libphonenumber-js.min.js"></script>

    <style>
        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
           BLOOMING KIDS ¬∑ PARENT PORTAL ‚Äî DESIGN SYSTEM
           Inspired by tutor.html (green+gold glass morphism)
           ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --primary:         #16a34a;
            --primary-light:   #22c55e;
            --primary-dark:    #15803d;
            --primary-xdark:   #166534;
            --primary-glow:    rgba(34,197,94,0.35);
            --primary-muted:   rgba(34,197,94,0.12);
            --accent:          #f59e0b;
            --accent-light:    #fbbf24;
            --accent-dark:     #d97706;
            --accent-glow:     rgba(245,158,11,0.4);
            --danger:          #ef4444;
            --info:            #3b82f6;
            --purple:          #8b5cf6;
            --surface:         rgba(255,255,255,0.72);
            --surface-solid:   rgba(255,255,255,0.95);
            --text:            #0f172a;
            --text-muted:      #475569;
            --text-xmuted:     #94a3b8;
            --border:          rgba(255,255,255,0.55);
            --border-solid:    #e2e8f0;
            --shadow-sm:       0 2px 8px -2px rgba(0,0,0,0.08);
            --shadow:          0 8px 24px -6px rgba(0,0,0,0.14), 0 2px 8px -2px rgba(0,0,0,0.06);
            --shadow-lg:       0 20px 48px -12px rgba(0,0,0,0.20), 0 8px 16px -6px rgba(0,0,0,0.08);
            --shadow-green:    0 8px 24px -6px rgba(22,163,74,0.35);
            --shadow-green-lg: 0 16px 40px -8px rgba(22,163,74,0.45);
            --blur:            18px;
            --radius-sm:       0.5rem;
            --radius:          0.875rem;
            --radius-lg:       1.5rem;
            --radius-xl:       2rem;
            --radius-pill:     9999px;
            --transition:      all 0.22s cubic-bezier(0.22,1,0.36,1);
        }

        body {
            font-family: 'Plus Jakarta Sans', -apple-system, sans-serif;
            background: url('https://res.cloudinary.com/dy2hxcyaf/image/upload/v1769020680/Gemini_Generated_Image_o5m8auo5m8auo5m8_hzzxks.png') center/cover fixed;
            min-height: 100vh;
            color: var(--text);
            -webkit-font-smoothing: antialiased;
            position: relative;
        }
        body::before {
            content: '';
            position: fixed; inset: 0;
            background: radial-gradient(ellipse 60% 50% at 15% 20%, rgba(34,197,94,0.10) 0%, transparent 55%),
                        radial-gradient(ellipse 50% 60% at 85% 80%, rgba(245,158,11,0.12) 0%, transparent 55%),
                        radial-gradient(ellipse 40% 40% at 50% 50%, rgba(255,255,255,0.04) 0%, transparent 70%);
            pointer-events: none; z-index: 0;
        }

        /* Ambient orbs */
        .orb { position: fixed; border-radius: 50%; filter: blur(80px); opacity: 0.18; z-index: 0; pointer-events: none; animation: orbFloat 22s infinite alternate ease-in-out; }
        .orb-1 { width: 380px; height: 380px; background: radial-gradient(circle, #22c55e, #16a34a); top: -120px; right: -80px; }
        .orb-2 { width: 480px; height: 480px; background: radial-gradient(circle, #fbbf24, #f59e0b); bottom: -180px; left: -120px; animation-delay: -7s; }
        @keyframes orbFloat { 0% { transform: translate(0,0) scale(1); } 50% { transform: translate(20px,-15px) scale(1.06); } 100% { transform: translate(-10px,20px) scale(0.96); } }

        #appRoot { position: relative; z-index: 1; }
        .hidden { display: none !important; }
        .preserve-whitespace { white-space: pre-wrap; }

        /* ‚ïê‚ïê‚ïê HEADER ‚ïê‚ïê‚ïê */
        .portal-header {
            background: var(--surface);
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            border-bottom: 1px solid rgba(255,255,255,0.4);
            padding: 0 28px; height: 68px;
            display: flex; align-items: center; justify-content: space-between;
            position: sticky; top: 0; z-index: 200;
            box-shadow: 0 4px 24px -8px rgba(0,0,0,0.12);
        }
        .portal-logo { display: flex; align-items: center; gap: 12px; }
        .portal-logo img { height: 40px; filter: drop-shadow(0 2px 4px rgba(22,163,74,0.2)); }
        .portal-logo-text h1 { font-size: 1rem; font-weight: 800; color: var(--primary-dark); line-height: 1.2; letter-spacing: -0.02em; }
        .portal-logo-text p { font-size: 0.68rem; color: var(--text-muted); line-height: 1; letter-spacing: 0.05em; text-transform: uppercase; font-weight: 600; }
        .portal-header-actions { display: flex; align-items: center; gap: 10px; }
        .header-greeting { font-size: 0.85rem; font-weight: 600; color: var(--primary-dark); }
        .btn-logout-header {
            display: flex; align-items: center; gap: 6px;
            padding: 8px 16px; border-radius: var(--radius-pill);
            background: rgba(239,68,68,0.12); color: #dc2626;
            border: 1px solid rgba(239,68,68,0.2);
            font-size: 0.82rem; font-weight: 700; cursor: pointer; font-family: inherit;
            transition: var(--transition);
        }
        .btn-logout-header:hover { background: rgba(239,68,68,0.2); transform: translateY(-1px); }

        /* ‚ïê‚ïê‚ïê AUTH ‚ïê‚ïê‚ïê */
        .auth-screen { min-height: calc(100vh - 68px); display: flex; align-items: center; justify-content: center; padding: 32px 16px; }
        .auth-card { width: 100%; max-width: 460px; background: rgba(255,255,255,0.92); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border-radius: 2rem; box-shadow: var(--shadow-lg); border: 1px solid rgba(255,255,255,0.6); overflow: hidden; }
        .auth-card-hero { background: linear-gradient(135deg, var(--primary) 0%, var(--primary-xdark) 100%); padding: 32px; text-align: center; }
        .auth-card-hero img { height: 50px; filter: brightness(0) invert(1); margin-bottom: 12px; }
        .auth-card-hero h2 { color: white; font-size: 1.4rem; font-weight: 800; letter-spacing: -0.02em; margin: 0; }
        .auth-card-hero p { color: rgba(255,255,255,0.75); font-size: 0.85rem; margin-top: 6px; }
        .auth-tabs { display: flex; background: rgba(241,245,249,0.8); border-bottom: 1px solid var(--border-solid); }
        .auth-tab-btn { flex: 1; padding: 13px; font-size: 0.88rem; font-weight: 700; border: none; cursor: pointer; transition: var(--transition); font-family: inherit; }
        .auth-tab-btn.active { background: var(--primary); color: white; }
        .auth-tab-btn:not(.active) { background: transparent; color: var(--primary); }
        .auth-tab-btn:not(.active):hover { background: rgba(22,163,74,0.08); }
        .auth-form-body { padding: 26px 30px; }
        .field-group { margin-bottom: 15px; }
        .field-label { display: block; font-size: 0.73rem; font-weight: 700; color: var(--text); margin-bottom: 5px; letter-spacing: 0.04em; text-transform: uppercase; }
        .field-input { width: 100%; padding: 11px 16px; border: 1.5px solid var(--border-solid); border-radius: var(--radius); font-size: 0.93rem; font-family: inherit; color: var(--text); background: white; transition: var(--transition); outline: none; }
        .field-input:focus { border-color: var(--primary); box-shadow: 0 0 0 3px var(--primary-muted); }
        .field-input::placeholder { color: #94a3b8; }

        .btn-primary { width: 100%; padding: 13px; background: linear-gradient(135deg, var(--primary-light), var(--primary-xdark)); color: white; border: none; border-radius: var(--radius); font-size: 0.93rem; font-weight: 700; font-family: inherit; cursor: pointer; transition: var(--transition); display: flex; align-items: center; justify-content: center; gap: 8px; box-shadow: var(--shadow-green); letter-spacing: -0.01em; }
        .btn-primary:hover { box-shadow: var(--shadow-green-lg); transform: translateY(-1px); }
        .btn-primary:disabled { opacity: 0.7; cursor: not-allowed; transform: none; }
        .btn-secondary { width: 100%; padding: 11px; background: rgba(248,250,252,0.9); color: var(--text-muted); border: 1.5px solid var(--border-solid); border-radius: var(--radius); font-size: 0.87rem; font-weight: 600; font-family: inherit; cursor: pointer; transition: var(--transition); }
        .btn-secondary:hover { background: #f1f5f9; }
        .forgot-link { background: none; border: none; color: var(--primary); font-size: 0.82rem; cursor: pointer; font-family: inherit; font-weight: 600; text-decoration: underline; text-decoration-color: transparent; transition: var(--transition); }
        .forgot-link:hover { text-decoration-color: var(--primary); }

        /* ‚ïê‚ïê‚ïê DASHBOARD ‚ïê‚ïê‚ïê */
        .dashboard-layout { max-width: 1240px; margin: 0 auto; padding: 22px 16px 80px; }

        .dashboard-welcome-bar {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-xdark) 100%);
            border-radius: 1.75rem; padding: 20px 26px; margin-bottom: 18px;
            display: flex; align-items: center; justify-content: space-between;
            flex-wrap: wrap; gap: 12px; box-shadow: var(--shadow-green-lg);
            position: relative; overflow: hidden;
        }
        .dashboard-welcome-bar::after { content: 'üåø'; position: absolute; right: 24px; bottom: -10px; font-size: 3.5rem; opacity: 0.12; transform: rotate(-20deg); pointer-events: none; }
        .welcome-text h2 { color: white; font-size: 1.2rem; font-weight: 800; margin: 0 0 3px; letter-spacing: -0.02em; }
        .welcome-text p { color: rgba(255,255,255,0.72); font-size: 0.82rem; margin: 0; }
        .welcome-actions { display: flex; gap: 8px; flex-wrap: wrap; align-items: center; }
        .btn-add-student { background: linear-gradient(135deg, var(--accent-light), var(--accent-dark)); color: #3d1f00; border: none; padding: 9px 18px; border-radius: var(--radius-pill); font-size: 0.82rem; font-weight: 700; font-family: inherit; cursor: pointer; transition: var(--transition); display: flex; align-items: center; gap: 6px; box-shadow: 0 4px 12px var(--accent-glow); }
        .btn-add-student:hover { box-shadow: 0 8px 20px var(--accent-glow); transform: translateY(-2px); }
        .btn-welcome-action { background: rgba(255,255,255,0.2); color: white; border: 1.5px solid rgba(255,255,255,0.35); padding: 8px 14px; border-radius: var(--radius-pill); font-size: 0.8rem; font-weight: 700; cursor: pointer; transition: var(--transition); display: flex; align-items: center; gap: 6px; font-family: inherit; }
        .btn-welcome-action:hover { background: rgba(255,255,255,0.32); transform: translateY(-1px); }

        /* Tab nav */
        .main-tabs { display: flex; background: rgba(0,0,0,0.06); border-radius: var(--radius-pill); padding: 4px; gap: 2px; margin-bottom: 20px; border: 1px solid rgba(255,255,255,0.3); box-shadow: 0 2px 12px -4px rgba(0,0,0,0.10), 0 0 0 1px rgba(255,255,255,0.15) inset; backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px); flex-wrap: wrap; }
        .main-tab-btn { flex: 1; min-width: 70px; padding: 9px 12px; border: none; border-radius: var(--radius-pill); font-size: 0.8rem; font-weight: 600; font-family: inherit; cursor: pointer; transition: var(--transition); display: flex; align-items: center; justify-content: center; gap: 5px; color: var(--text); opacity: 0.62; background: transparent; white-space: nowrap; }
        .main-tab-btn.active { background: white; color: var(--primary-dark); opacity: 1; font-weight: 700; box-shadow: 0 4px 16px -4px rgba(0,0,0,0.18), 0 0 0 1px rgba(255,255,255,0.8) inset; }
        .main-tab-btn:not(.active):hover { opacity: 0.85; background: rgba(255,255,255,0.4); }

        .content-area { animation: fadeUp 0.3s ease; }
        @keyframes fadeUp { from { opacity:0; transform:translateY(8px); } to { opacity:1; transform:translateY(0); } }
        .content-header { margin-bottom: 16px; }
        .content-header h2 { font-size: 1.35rem; font-weight: 800; color: var(--text); margin: 0 0 4px; letter-spacing: -0.02em; }
        .content-header p { color: var(--text-muted); font-size: 0.84rem; margin: 0; }

        .card { background: var(--surface); backdrop-filter: blur(var(--blur)); -webkit-backdrop-filter: blur(var(--blur)); border: 1px solid rgba(255,255,255,0.45); border-radius: var(--radius-lg); box-shadow: var(--shadow); }
        .card-elevated { background: var(--surface); backdrop-filter: blur(var(--blur)); -webkit-backdrop-filter: blur(var(--blur)); border: 1px solid rgba(255,255,255,0.5); border-radius: var(--radius-lg); box-shadow: var(--shadow-lg); }

        .accordion-header { background: rgba(255,255,255,0.55); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.5); border-radius: var(--radius); padding: 16px 20px; cursor: pointer; display: flex; align-items: center; justify-content: space-between; transition: var(--transition); box-shadow: var(--shadow-sm); }
        .accordion-header:hover { background: rgba(255,255,255,0.75); transform: translateY(-1px); box-shadow: var(--shadow); }
        .accordion-content { overflow: hidden; transition: max-height 0.35s cubic-bezier(0.4,0,0.2,1), opacity 0.3s ease; }
        .accordion-content.hidden { max-height: 0 !important; opacity: 0; }
        .accordion-content:not(.hidden) { max-height: 8000px; opacity: 1; }

        .student-report-card { background: rgba(255,255,255,0.72); backdrop-filter: blur(14px); -webkit-backdrop-filter: blur(14px); border-radius: var(--radius-lg); border: 1px solid rgba(255,255,255,0.55); overflow: hidden; margin-bottom: 14px; box-shadow: var(--shadow); transition: var(--transition); }
        .student-report-card:hover { transform: translateY(-2px); box-shadow: var(--shadow-lg); }
        .student-report-card-header { padding: 16px 20px; display: flex; align-items: center; justify-content: space-between; cursor: pointer; border-bottom: 1px solid rgba(255,255,255,0.4); }
        .student-avatar { width: 42px; height: 42px; background: linear-gradient(145deg, var(--primary-light), var(--primary-xdark)); border-radius: 1rem; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; margin-right: 13px; flex-shrink: 0; box-shadow: 0 4px 12px var(--primary-glow); }

        .badge { display: inline-flex; align-items: center; padding: 3px 9px; border-radius: var(--radius-pill); font-size: 0.71rem; font-weight: 700; }
        .badge-green  { background: #dcfce7; color: #166534; }
        .badge-yellow { background: #fef9c3; color: #854d0e; }
        .badge-red    { background: #fee2e2; color: #991b1b; }
        .badge-blue   { background: #dbeafe; color: #1e3a8a; }
        .badge-gray   { background: #f3f4f6; color: #4b5563; }

        .loading-spinner { border: 3px solid var(--primary-muted); border-top: 3px solid var(--primary); border-radius: 50%; width: 28px; height: 28px; animation: spin 0.8s linear infinite; display: inline-block; }
        .loading-spinner-small { border: 2px solid rgba(255,255,255,0.3); border-top: 2px solid white; border-radius: 50%; width: 16px; height: 16px; animation: spin 0.8s linear infinite; display: inline-block; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .skeleton { background: linear-gradient(90deg, rgba(255,255,255,0.3) 25%, rgba(255,255,255,0.5) 50%, rgba(255,255,255,0.3) 75%); background-size: 200% 100%; animation: shimmer 1.5s infinite; border-radius: 6px; }
        @keyframes shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }

        .message-toast { position: fixed; top: 80px; right: 16px; padding: 12px 18px; border-radius: var(--radius); color: white; font-weight: 600; font-family: inherit; z-index: 9999; max-width: 340px; box-shadow: 0 8px 24px rgba(0,0,0,0.2); animation: slideInRight 0.3s ease; font-size: 0.87rem; }
        @keyframes slideInRight { from { transform: translateX(120%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

        /* ‚ïê‚ïê‚ïê MODALS ‚ïê‚ïê‚ïê */
        .modal-overlay { position: fixed; inset: 0; background: rgba(15,23,42,0.55); backdrop-filter: blur(6px); -webkit-backdrop-filter: blur(6px); display: flex; align-items: center; justify-content: center; z-index: 1000; padding: 16px; }
        .modal-box { background: white; border-radius: 1.5rem; width: 100%; max-width: 580px; max-height: 90vh; overflow-y: auto; box-shadow: 0 32px 72px rgba(0,0,0,0.25); animation: modalIn 0.3s cubic-bezier(0.4,0,0.2,1); }
        .modal-box-wide { max-width: 700px; }
        @keyframes modalIn { from { opacity:0; transform:scale(0.95) translateY(10px); } to { opacity:1; transform:scale(1) translateY(0); } }
        .modal-header { padding: 20px 24px 16px; border-bottom: 1px solid #e2e8f0; display: flex; align-items: center; justify-content: space-between; }
        .modal-header h3 { font-size: 1.1rem; font-weight: 800; color: var(--primary-xdark); margin: 0; letter-spacing: -0.02em; }
        .modal-close { background: #f1f5f9; border: none; border-radius: 50%; width: 30px; height: 30px; font-size: 1.1rem; cursor: pointer; display: flex; align-items: center; justify-content: center; color: #64748b; transition: var(--transition); }
        .modal-close:hover { background: #e2e8f0; color: var(--text); }
        .modal-body { padding: 20px 24px; }
        .modal-footer { padding: 12px 24px 20px; display: flex; gap: 10px; }

        /* Modal inner tab nav */
        .modal-tab-nav { display: flex; border-bottom: 2px solid #e2e8f0; margin-bottom: 18px; }
        .modal-tab-btn { flex: 1; padding: 11px; text-align: center; font-weight: 700; font-size: 0.84rem; cursor: pointer; background: none; border: none; font-family: inherit; color: #64748b; transition: var(--transition); border-bottom: 2px solid transparent; margin-bottom: -2px; }
        .modal-tab-btn.active { color: var(--primary-dark); border-bottom-color: var(--primary); }

        /* Stepper */
        .stepper { display: flex; gap: 7px; margin-bottom: 20px; }
        .step-item { flex: 1; height: 4px; border-radius: 2px; background: #e2e8f0; transition: background 0.3s; }
        .step-item.active { background: var(--primary); }
        .step-item.done   { background: var(--primary-light); }
        .step-panel { display: none; }
        .step-panel.active { display: block; }

        /* Picker chips */
        .picker-grid { display: flex; flex-wrap: wrap; gap: 7px; }
        .picker-chip { padding: 6px 13px; border: 1.5px solid #e2e8f0; border-radius: var(--radius-pill); font-size: 0.79rem; font-weight: 600; font-family: inherit; cursor: pointer; transition: var(--transition); background: white; color: #4b5563; }
        .picker-chip:hover { border-color: var(--primary-light); color: var(--primary); }
        .picker-chip.selected { background: var(--primary); border-color: var(--primary); color: white; }

        /* Referral */
        .referral-code-box { background: linear-gradient(135deg, var(--primary-xdark), var(--primary)); border-radius: var(--radius-lg); padding: 24px; color: white; margin-bottom: 20px; }
        .referral-code-display { font-family: 'Courier New', monospace; font-size: 1.7rem; font-weight: 700; letter-spacing: 0.12em; background: rgba(255,255,255,0.15); padding: 10px 16px; border-radius: 10px; display: inline-block; border: 1.5px dashed rgba(255,255,255,0.5); user-select: all; }

        .info-tile { background: rgba(241,245,249,0.8); border: 1px solid #e2e8f0; border-radius: 10px; padding: 11px 15px; display: flex; align-items: flex-start; gap: 11px; }
        .grade-circle { width: 56px; height: 56px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.15rem; font-weight: 800; }
        .grade-a { background: #dcfce7; color: #166534; }
        .grade-b { background: #dbeafe; color: #1e3a8a; }
        .grade-c { background: #fef9c3; color: #854d0e; }
        .grade-f { background: #fee2e2; color: #991b1b; }

        .btn-download { background: linear-gradient(135deg, var(--primary-light), var(--primary-xdark)); color: white; border: none; padding: 8px 15px; border-radius: var(--radius-pill); font-size: 0.79rem; font-weight: 700; font-family: inherit; cursor: pointer; transition: var(--transition); display: inline-flex; align-items: center; gap: 5px; box-shadow: var(--shadow-green); }
        .btn-download:hover { box-shadow: var(--shadow-green-lg); transform: translateY(-1px); }

        /* Footer */
        .portal-footer { text-align: center; padding: 22px 16px; color: rgba(255,255,255,0.7); font-size: 0.79rem; position: relative; z-index: 10; }
        .portal-footer-links { display: flex; justify-content: center; align-items: center; gap: 8px; margin-top: 6px; }
        .portal-footer-link { background: none; border: none; color: rgba(255,255,255,0.72); font-size: 0.76rem; font-weight: 600; cursor: pointer; font-family: inherit; text-decoration: underline; text-decoration-color: transparent; transition: var(--transition); }
        .portal-footer-link:hover { color: white; text-decoration-color: white; }
        .portal-footer-link[href] { text-decoration: none; }
        .portal-footer-link[href]:hover { color: white; }

        /* FAB */
        .fab-container { position: fixed; bottom: 22px; right: 22px; z-index: 500; display: flex; flex-direction: column; align-items: flex-end; gap: 8px; }
        .fab-menu { display: flex; flex-direction: column; gap: 7px; align-items: flex-end; transition: var(--transition); pointer-events: none; opacity: 0; transform: translateY(12px) scale(0.95); }
        .fab-menu.open { pointer-events: auto; opacity: 1; transform: translateY(0) scale(1); }
        .fab-menu-item { display: flex; align-items: center; gap: 10px; padding: 10px 18px; border-radius: var(--radius-pill); border: none; font-size: 0.84rem; font-weight: 700; font-family: inherit; cursor: pointer; transition: var(--transition); box-shadow: var(--shadow); white-space: nowrap; }
        .fab-menu-item.feedback-item { background: linear-gradient(135deg, #7c3aed, #6d28d9); color: white; }
        .fab-menu-item.messages-item { background: linear-gradient(135deg, var(--primary-light), var(--primary-xdark)); color: white; }
        .fab-menu-item:hover { transform: translateY(-2px); box-shadow: var(--shadow-lg); }
        .fab-main { width: 54px; height: 54px; border-radius: 50%; background: linear-gradient(135deg, var(--primary-light), var(--primary-xdark)); color: white; border: none; font-size: 1.25rem; cursor: pointer; transition: var(--transition); box-shadow: var(--shadow-green-lg); display: flex; align-items: center; justify-content: center; }
        .fab-main:hover { transform: scale(1.08) rotate(10deg); box-shadow: 0 20px 40px rgba(22,163,74,0.5); }
        .fab-main.open { transform: rotate(45deg); background: linear-gradient(135deg, #ef4444, #dc2626); }

        /* Payments coming soon */
        .payments-soon { text-align: center; padding: 52px 24px; background: var(--surface); backdrop-filter: blur(var(--blur)); -webkit-backdrop-filter: blur(var(--blur)); border: 1px solid rgba(255,255,255,0.45); border-radius: var(--radius-lg); box-shadow: var(--shadow); }
        .payments-soon-icon { font-size: 3.8rem; margin-bottom: 14px; display: block; }
        .payments-soon h2 { font-size: 1.4rem; font-weight: 800; color: var(--primary-xdark); margin-bottom: 10px; letter-spacing: -0.02em; }
        .payments-soon p { color: var(--text-muted); font-size: 0.88rem; max-width: 420px; margin: 0 auto; line-height: 1.65; }
        .coin-spin { display: inline-block; animation: coinSpin 3s ease-in-out infinite; font-size: 2rem; margin-top: 14px; }
        @keyframes coinSpin { 0%,100% { transform: rotateY(0deg); } 50% { transform: rotateY(180deg); } }

        /* Settings area */
        #settingsContentArea .settings-inner { background: rgba(255,255,255,0.88); backdrop-filter: blur(var(--blur)); border: 1px solid rgba(255,255,255,0.55); border-radius: var(--radius-lg); overflow: hidden; box-shadow: var(--shadow-lg); }
        #settingsContentArea .settings-header { background: linear-gradient(135deg, var(--primary-xdark), var(--primary)); padding: 18px 24px; display: flex; align-items: center; justify-content: space-between; }

        /* Response bubble */
        .response-bubble { background: #f0fdf4; border: 1px solid #bbf7d0; border-radius: 10px; padding: 10px 14px; }
        .response-header { font-size: 0.73rem; font-weight: 700; color: #166534; margin-bottom: 4px; text-transform: uppercase; }

        /* Academics */
        .topic-item { border-left: 4px solid var(--info); transition: var(--transition); }
        .topic-item:hover { transform: translateX(4px); }
        .homework-item { border-left: 4px solid var(--purple); transition: var(--transition); }
        .homework-item:hover { transform: translateX(4px); }
        .status-overdue   { background: #fef2f2; color: #dc2626; }
        .status-pending   { background: #eff6ff; color: #1d4ed8; }
        .status-submitted { background: #f0fdf4; color: #15803d; }
        .chart-container { position: relative; height: 280px; width: 100%; }

        /* Responsive */
        @media (max-width: 640px) {
            .portal-header { padding: 0 14px; }
            .main-tab-btn .tab-label { display: none; }
            .dashboard-welcome-bar { padding: 16px; }
            .modal-body, .modal-header, .modal-footer { padding-left: 14px; padding-right: 14px; }
            .fab-container { bottom: 14px; right: 14px; }
        }

        .fade-in  { animation: fadeIn 0.3s ease; }
        .slide-down { animation: slideDown 0.3s ease-out; }
        @keyframes fadeIn { from { opacity:0; } to { opacity:1; } }
        @keyframes slideDown { from { transform:translateY(-10px); opacity:0; } to { transform:translateY(0); opacity:1; } }

        /* GC Modal styles */
        .gc-modal-overlay { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); z-index:9999; display:flex; justify-content:center; align-items:center; backdrop-filter:blur(4px); animation:fadeIn 0.2s; }
        .gc-modal-container { background:#fff; width:90%; max-width:1000px; height:90vh; border-radius:8px; display:flex; flex-direction:column; overflow:hidden; box-shadow:0 4px 24px rgba(0,0,0,0.2); }
        .gc-header { padding:16px 24px; border-bottom:1px solid #e0e0e0; display:flex; justify-content:space-between; align-items:center; }
        .gc-body { display:flex; flex:1; overflow-y:auto; background:#fff; }
        .gc-main { flex:1; padding:24px; border-right:1px solid #f0f0f0; }
        .gc-sidebar { width:350px; padding:24px; background:#fff; }
        .gc-title { font-size:2rem; color:#1967d2; margin-bottom:8px; font-weight:400; }
        .gc-card { background:#fff; border:1px solid #dadce0; border-radius:8px; padding:16px; box-shadow:0 1px 2px rgba(60,64,67,0.3); margin-bottom:16px; }
        .gc-btn-add { display:flex; align-items:center; justify-content:center; width:100%; padding:10px; margin-bottom:10px; background:#fff; border:1px solid #dadce0; border-radius:4px; color:#1967d2; font-weight:500; cursor:pointer; transition:0.2s; }
        .gc-btn-add:hover { background:#f8f9fa; }
        .gc-btn-primary { width:100%; padding:10px; background:#1967d2; border:none; border-radius:4px; color:#fff; font-weight:500; cursor:pointer; transition:0.2s; }
        .gc-btn-primary:hover { background:#185abc; }
        .gc-btn-primary:disabled { background:#e0e0e0; cursor:not-allowed; }
        .gc-btn-unsubmit { width:100%; padding:10px; background:#fff; border:1px solid #dadce0; border-radius:4px; color:#3c4043; font-weight:500; cursor:pointer; margin-top:10px; }
        .gc-attachment { display:flex; align-items:center; border:1px solid #dadce0; border-radius:4px; padding:8px; margin-bottom:12px; cursor:pointer; }
        .gc-att-icon { width:36px; height:36px; background:#f1f3f4; color:#1967d2; display:flex; align-items:center; justify-content:center; margin-right:12px; border-radius:4px; }
        @media (max-width:768px) { .gc-body { flex-direction:column; } .gc-sidebar { width:100%; border-top:1px solid #e0e0e0; } }
    </style>
</head>

<body>
<div class="orb orb-1"></div>
<div class="orb orb-2"></div>

<div id="appRoot">

<!-- ‚ïê‚ïê‚ïê HEADER ‚ïê‚ïê‚ïê -->
<header class="portal-header">
    <div class="portal-logo">
        <img src="https://res.cloudinary.com/dy2hxcyaf/image/upload/v1757700806/newbhlogo_umwqzy.svg" alt="Blooming Kids House Logo">
        <div class="portal-logo-text">
            <h1>Blooming Kids House</h1>
            <p>Parent Portal</p>
        </div>
    </div>
    <!-- Single logout button ‚Äî only in the header -->
    <div class="portal-header-actions" id="headerActions" style="display:none;">
        <span class="header-greeting" id="headerGreeting">Welcome!</span>
        <button onclick="logout()" class="btn-logout-header">
            <i class="fa-solid fa-right-from-bracket"></i>
            <span>Logout</span>
        </button>
    </div>
</header>

<!-- ‚ïê‚ïê‚ïê AUTH ‚ïê‚ïê‚ïê -->
<div id="authArea" class="auth-screen">
    <div class="auth-card">
        <div class="auth-card-hero">
            <img src="https://res.cloudinary.com/dy2hxcyaf/image/upload/v1757700806/newbhlogo_umwqzy.svg" alt="BKH Logo">
            <h2>Welcome Back</h2>
            <p>Secure access to your children's progress üå±</p>
        </div>
        <div class="auth-tabs">
            <button id="signInTab" class="auth-tab-btn active" onclick="switchTab('signin')">Sign In</button>
            <button id="signUpTab" class="auth-tab-btn" onclick="switchTab('signup')">Sign Up</button>
        </div>

        <!-- Sign In -->
        <div class="auth-form-body" id="signInForm">
            <div class="field-group">
                <label class="field-label" for="loginIdentifier">Phone Number or Email</label>
                <input id="loginIdentifier" type="text" placeholder="Enter your phone or email" class="field-input" required>
            </div>
            <div class="field-group">
                <label class="field-label" for="loginPassword">Password</label>
                <input id="loginPassword" type="password" placeholder="Enter your password" class="field-input" required>
            </div>
            <div class="flex items-center mb-4">
                <input id="rememberMe" type="checkbox" class="h-4 w-4 rounded" style="accent-color:var(--primary)">
                <label for="rememberMe" class="ml-2 text-sm text-gray-600">Remember me</label>
            </div>
            <button id="signInBtn" class="btn-primary mb-3">
                <span id="signInText">Sign In</span>
                <div id="signInSpinner" class="loading-spinner-small hidden"></div>
            </button>
            <div class="text-center">
                <button id="forgotPasswordBtn" class="forgot-link">Forgot Password?</button>
            </div>
        </div>

        <!-- Sign Up -->
        <div class="auth-form-body hidden" id="signUpForm">
            <div id="phoneInputContainer">
                <div class="field-group">
                    <label class="field-label" for="signupPhone">Phone Number</label>
                    <input id="signupPhone" type="tel" placeholder="Enter your phone number" class="field-input" required>
                </div>
            </div>
            <div class="field-group">
                <label class="field-label" for="signupEmail">Email Address</label>
                <input id="signupEmail" type="email" placeholder="Enter your email address" class="field-input" required>
            </div>
            <div class="field-group">
                <label class="field-label" for="signupPassword">Password</label>
                <input id="signupPassword" type="password" placeholder="Minimum 6 characters" class="field-input" required minlength="6">
            </div>
            <div class="field-group">
                <label class="field-label" for="signupConfirmPassword">Confirm Password</label>
                <input id="signupConfirmPassword" type="password" placeholder="Confirm your password" class="field-input" required minlength="6">
            </div>
            <button id="signUpBtn" class="btn-primary">
                <span id="signUpText">Create Account</span>
                <div id="signUpSpinner" class="loading-spinner-small hidden"></div>
            </button>
        </div>

        <div id="authLoader" class="hidden text-center pb-6">
            <div class="loading-spinner mx-auto" style="width:32px;height:32px;border-top-color:var(--primary);border-color:var(--primary-muted);"></div>
            <p class="mt-2 text-sm" style="color:var(--primary);">Processing‚Ä¶ please wait</p>
        </div>
    </div>
</div>

<!-- ‚ïê‚ïê‚ïê DASHBOARD ‚ïê‚ïê‚ïê -->
<div id="reportArea" class="hidden dashboard-layout">

    <!-- Welcome Banner (NO logout here ‚Äî avoid duplicate) -->
    <div class="dashboard-welcome-bar">
        <div class="welcome-text">
            <h2 id="welcomeMessage">Welcome!</h2>
            <p>Thank you for being part of the Blooming Kids House family üåø</p>
        </div>
        <div class="welcome-actions">
            <button class="btn-add-student" onclick="showAddStudentModal()">
                <i class="fa-solid fa-user-plus"></i>
                <span>Add Student</span>
            </button>
            <button id="manualRefreshBtn" class="btn-welcome-action" onclick="manualRefreshReportsV2()">
                <i class="fa-solid fa-rotate-right"></i>
                <span>Refresh</span>
            </button>
        </div>
    </div>

    <!-- Tab Navigation (5 tabs: Reports, Academics, Rewards, Payments, Settings) -->
    <nav class="main-tabs" id="mainTabNav">
        <button id="reportTab" class="main-tab-btn active" onclick="switchMainTab('report')">
            <i class="fa-solid fa-file-lines"></i>
            <span class="tab-label">Reports</span>
        </button>
        <button id="academicsTab" class="main-tab-btn" onclick="switchMainTab('academics')">
            <i class="fa-solid fa-book-open"></i>
            <span class="tab-label">Academics</span>
        </button>
        <button id="rewardsTab" class="main-tab-btn" onclick="switchMainTab('rewards')">
            <i class="fa-solid fa-gift"></i>
            <span class="tab-label">Rewards</span>
        </button>
        <button id="paymentsTab" class="main-tab-btn" onclick="switchMainTab('payments')">
            <i class="fa-solid fa-credit-card"></i>
            <span class="tab-label">Payments</span>
        </button>
        <button id="settingsTab" class="main-tab-btn" onclick="switchMainTab('settings')">
            <i class="fa-solid fa-gear"></i>
            <span class="tab-label">Settings</span>
        </button>
    </nav>

    <!-- Reports -->
    <div id="reportContentArea" class="content-area">
        <div class="content-header">
            <h2>Children's Progress Reports</h2>
            <p>Click on a student's card to expand their reports</p>
        </div>
        <div id="reportsLoading" class="hidden text-center py-12">
            <div class="loading-spinner mx-auto" style="width:40px;height:40px;"></div>
            <p class="mt-4 text-sm" style="color:var(--primary);">Loading reports‚Ä¶</p>
        </div>
        <div id="reportsEmpty" class="hidden text-center py-16 card" style="padding:48px;">
            <div style="font-size:3.5rem;margin-bottom:14px;">üì¨</div>
            <h3 style="font-size:1.05rem;font-weight:800;color:#374151;margin:0 0 8px;">No Reports Available</h3>
            <p style="color:#6b7280;font-size:0.85rem;max-width:360px;margin:0 auto;">No progress reports available yet. Check back after your child's sessions.</p>
        </div>
        <div id="reportContent" class="space-y-4"></div>
    </div>

    <!-- Academics -->
    <div id="academicsContentArea" class="content-area hidden">
        <div class="content-header">
            <h2>Academic Progress &amp; Assignments</h2>
            <p>Subjects, schedule, session topics, and homework</p>
        </div>
        <div id="academicsStudentDropdown" class="mb-4"></div>
        <div id="academicsContent" class="card" style="padding:24px;min-height:300px;"></div>
    </div>

    <!-- Rewards -->
    <div id="rewardsContentArea" class="content-area hidden">
        <div class="content-header">
            <h2>Referral Rewards Dashboard</h2>
            <p>Track your earnings and referral history</p>
        </div>
        <div id="rewardsContent" class="card" style="padding:24px;min-height:300px;"></div>
    </div>

    <!-- Payments (Coming Soon) -->
    <div id="paymentsContentArea" class="content-area hidden">
        <div class="payments-soon">
            <span class="payments-soon-icon">üí≥</span>
            <h2>Payments &amp; Billing</h2>
            <p>
                We're counting coins and polishing the payment portal! üí∞‚ú®<br>
                Our team is working hard to bring you a seamless fee payment experience.
                Check back soon to settle fees with a smile ‚Äî and maybe even a surprise discount for your patience! üòÑ
            </p>
            <div class="coin-spin">ü™ô</div>
            <div style="margin-top:28px;display:flex;justify-content:center;gap:14px;flex-wrap:wrap;">
                <div style="background:rgba(22,163,74,0.1);border:1px solid rgba(22,163,74,0.2);padding:14px 22px;border-radius:var(--radius);text-align:center;">
                    <div style="font-size:1.6rem;">üìä</div>
                    <div style="font-size:0.76rem;font-weight:700;color:var(--primary-dark);margin-top:4px;">Fee Statements</div>
                    <div style="font-size:0.7rem;color:var(--text-muted);">Coming Soon</div>
                </div>
                <div style="background:rgba(245,158,11,0.1);border:1px solid rgba(245,158,11,0.2);padding:14px 22px;border-radius:var(--radius);text-align:center;">
                    <div style="font-size:1.6rem;">üì±</div>
                    <div style="font-size:0.76rem;font-weight:700;color:var(--accent-dark);margin-top:4px;">Online Payment</div>
                    <div style="font-size:0.7rem;color:var(--text-muted);">Coming Soon</div>
                </div>
                <div style="background:rgba(59,130,246,0.1);border:1px solid rgba(59,130,246,0.2);padding:14px 22px;border-radius:var(--radius);text-align:center;">
                    <div style="font-size:1.6rem;">üßæ</div>
                    <div style="font-size:0.76rem;font-weight:700;color:#1e3a8a;margin-top:4px;">Receipts</div>
                    <div style="font-size:0.7rem;color:var(--text-muted);">Coming Soon</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings (populated by SettingsManager) -->
    <div id="settingsContentArea" class="content-area hidden">
        <div class="content-header">
            <h2>Family Profile &amp; Settings</h2>
            <p>Manage your profile and your children's details</p>
        </div>
        <div class="settings-inner" style="background:rgba(255,255,255,0.88);backdrop-filter:blur(var(--blur));border:1px solid rgba(255,255,255,0.55);border-radius:var(--radius-lg);overflow:hidden;box-shadow:var(--shadow-lg);">
            <div id="settingsDynamicContent" style="padding:24px;">
                <div class="text-center py-8">
                    <div class="loading-spinner mx-auto"></div>
                    <p class="mt-3 text-sm" style="color:var(--primary);">Loading settings‚Ä¶</p>
                </div>
            </div>
        </div>
    </div>

</div><!-- /reportArea -->

<!-- ‚ïê‚ïê‚ïê FOOTER ‚ïê‚ïê‚ïê -->
<footer class="portal-footer">
    <p>¬© 2025 Blooming Kids House ¬∑ Where Every Child Blossoms üå±</p>
    <div class="portal-footer-links">
        <button class="portal-footer-link" onclick="showPrivacyModal()">Privacy Policy</button>
        <span style="color:rgba(255,255,255,0.3);">|</span>
        <button class="portal-footer-link" onclick="showPrivacyModal('terms')">Terms of Use</button>
        <span style="color:rgba(255,255,255,0.3);">|</span>
        <a href="/cdn-cgi/l/email-protection#c2b1b7b2b2adb0b682a0aeadadafabaca5a9aba6b1aaadb7b1a7eca1adaf" class="portal-footer-link">Contact Support</a>
    </div>
</footer>

</div><!-- /appRoot -->

<!-- ‚ïê‚ïê‚ïê FAB (Feedback + Messages merged into one floating button) ‚ïê‚ïê‚ïê -->
<div class="fab-container" id="fabContainer" style="display:none;">
    <div class="fab-menu" id="fabMenu">
        <button class="fab-menu-item messages-item" onclick="openFabTab('messages');closeFab();">
            <i class="fa-solid fa-envelope"></i>
            <span>Messages</span>
        </button>
        <button class="fab-menu-item feedback-item" onclick="openFabTab('feedback');closeFab();">
            <i class="fa-solid fa-comment-dots"></i>
            <span>Send Feedback</span>
        </button>
    </div>
    <button class="fab-main" id="fabMainBtn" onclick="toggleFab()" title="Feedback &amp; Messages" aria-label="Open feedback and messages">
        <i class="fa-solid fa-plus"></i>
    </button>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MODALS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

<!-- Combined Feedback + Messages Modal -->
<div id="fabModal" class="modal-overlay hidden">
    <div class="modal-box modal-box-wide">
        <div class="modal-header">
            <h3>üí¨ Feedback &amp; Messages</h3>
            <button class="modal-close" onclick="document.getElementById('fabModal').classList.add('hidden')">√ó</button>
        </div>
        <div class="modal-body" style="padding-top:0;">
            <div class="modal-tab-nav">
                <button class="modal-tab-btn active" id="fabTabFeedback" onclick="switchFabModalTab('feedback')">
                    <i class="fa-solid fa-comment-dots mr-1"></i> Send Feedback
                </button>
                <button class="modal-tab-btn" id="fabTabMessages" onclick="switchFabModalTab('messages')">
                    <i class="fa-solid fa-envelope mr-1"></i> Messages
                </button>
            </div>
            <!-- Feedback Panel -->
            <div id="fabPanelFeedback">
                <p style="color:#6b7280;font-size:0.85rem;margin-bottom:16px;">We value your feedback! Please fill in the details below.</p>
                <div class="field-group">
                    <label class="field-label" for="feedbackCategory">Category *</label>
                    <select id="feedbackCategory" class="field-input" required>
                        <option value="">Select category</option>
                        <option value="Feedback">General Feedback</option>
                        <option value="Request">Special Request</option>
                        <option value="Complaint">Complaint</option>
                        <option value="Suggestion">Suggestion</option>
                    </select>
                </div>
                <div class="field-group">
                    <label class="field-label" for="feedbackPriority">Priority *</label>
                    <select id="feedbackPriority" class="field-input" required>
                        <option value="">Select priority</option>
                        <option value="Low">Low</option>
                        <option value="Medium">Medium</option>
                        <option value="High">High</option>
                        <option value="Urgent">Urgent</option>
                    </select>
                </div>
                <div class="field-group">
                    <label class="field-label" for="feedbackStudent">Regarding Student *</label>
                    <select id="feedbackStudent" class="field-input" required>
                        <option value="">Select student</option>
                    </select>
                </div>
                <div class="field-group">
                    <label class="field-label" for="feedbackMessage">Your Message *</label>
                    <textarea id="feedbackMessage" rows="4" class="field-input preserve-whitespace" placeholder="Describe your feedback‚Ä¶" required style="resize:vertical;"></textarea>
                </div>
                <button id="submitFeedbackBtn" class="btn-primary" onclick="submitFeedback()">
                    <span id="submitFeedbackText">Submit Feedback</span>
                    <div id="submitFeedbackSpinner" class="loading-spinner-small hidden"></div>
                </button>
            </div>
            <!-- Messages Panel -->
            <div id="fabPanelMessages" style="display:none;">
                <p style="color:#6b7280;font-size:0.85rem;margin-bottom:16px;">Responses from our staff to your submitted feedback.</p>
                <div id="responsesContent"></div>
            </div>
        </div>
    </div>
</div>

<!-- Legacy modal aliases (for JS backward-compat) -->
<div id="feedbackModal" class="hidden"></div>
<div id="responsesModal" class="hidden"></div>

<!-- Password Reset -->
<div id="passwordResetModal" class="modal-overlay hidden">
    <div class="modal-box" style="max-width:420px;">
        <div class="modal-header">
            <h3>üîë Reset Password</h3>
            <button class="modal-close" onclick="hidePasswordResetModal()">√ó</button>
        </div>
        <div class="modal-body">
            <p style="color:#6b7280;font-size:0.85rem;margin-bottom:16px;">Enter your email and we'll send you a reset link.</p>
            <div class="field-group">
                <label class="field-label" for="resetEmail">Email Address</label>
                <input id="resetEmail" type="email" placeholder="your@email.com" class="field-input">
            </div>
        </div>
        <div class="modal-footer">
            <button id="sendResetBtn" class="btn-primary" onclick="sendPasswordReset()" style="flex:1;">
                Send Reset Link
                <div id="resetLoader" class="loading-spinner-small hidden"></div>
            </button>
            <button class="btn-secondary" onclick="hidePasswordResetModal()" style="width:auto;padding:11px 18px;">Cancel</button>
        </div>
    </div>
</div>

<!-- Add Student (Full Enrollment Flow with Fee Summary) -->
<div id="addStudentModal" class="modal-overlay hidden">
    <div class="modal-box modal-box-wide">
        <div class="modal-header">
            <h3><i class="fa-solid fa-user-plus mr-2" style="color:var(--primary);"></i>Add Another Student</h3>
            <button class="modal-close" onclick="hideAddStudentModal()">√ó</button>
        </div>
        <div class="modal-body">
            <!-- Step Progress -->
            <div class="stepper" id="addStudentStepper">
                <div class="step-item active" id="stepBar1"></div>
                <div class="step-item" id="stepBar2"></div>
                <div class="step-item" id="stepBar3"></div>
                <div class="step-item" id="stepBar4"></div>
            </div>
            <p style="font-size:0.77rem;color:var(--text-muted);margin-bottom:18px;font-weight:600;" id="stepLabel">Step 1 of 4 ‚Äî Student Details</p>

            <!-- Step 1 -->
            <div class="step-panel active" id="add-step-1">
                <h4 style="font-size:0.92rem;font-weight:800;color:var(--primary-xdark);margin:0 0 14px;">Step 1 ‚Äî Student Details</h4>
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:13px;">
                    <div class="field-group" style="margin:0;">
                        <label class="field-label" for="newStudentFirstName">First Name *</label>
                        <input id="newStudentFirstName" type="text" placeholder="First name" class="field-input" required>
                    </div>
                    <div class="field-group" style="margin:0;">
                        <label class="field-label" for="newStudentLastName">Last Name *</label>
                        <input id="newStudentLastName" type="text" placeholder="Last name" class="field-input" required>
                    </div>
                </div>
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:13px;margin-top:13px;">
                    <div class="field-group" style="margin:0;">
                        <label class="field-label" for="newStudentGender">Gender *</label>
                        <select id="newStudentGender" class="field-input" required>
                            <option value="">Select gender</option>
                            <option value="male">Male</option>
                            <option value="female">Female</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="field-group" style="margin:0;">
                        <label class="field-label" for="newStudentDob">Date of Birth *</label>
                        <input id="newStudentDob" type="date" class="field-input" required>
                    </div>
                </div>
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:13px;margin-top:13px;">
                    <div class="field-group" style="margin:0;">
                        <label class="field-label" for="newStudentGradeLevel">Grade Tier *</label>
                        <select id="newStudentGradeLevel" class="field-input" required onchange="updateAddStudentFees()">
                            <option value="">Select grade tier</option>
                            <option value="preschool">Preschool to Grade 1</option>
                            <option value="grade2-4">Grade 2 to 4</option>
                            <option value="grade5-8">Grade 5 to 8</option>
                            <option value="grade9-12">Grade 9 to 12</option>
                        </select>
                    </div>
                    <div class="field-group" style="margin:0;">
                        <label class="field-label" for="newStudentActualGrade">Actual Grade *</label>
                        <select id="newStudentActualGrade" class="field-input" required>
                            <option value="">Select grade</option>
                            <option value="preschool">Preschool</option>
                            <option value="kindergarten">Kindergarten</option>
                            <option value="grade1">Grade 1</option><option value="grade2">Grade 2</option>
                            <option value="grade3">Grade 3</option><option value="grade4">Grade 4</option>
                            <option value="grade5">Grade 5</option><option value="grade6">Grade 6</option>
                            <option value="grade7">Grade 7</option><option value="grade8">Grade 8</option>
                            <option value="grade9">Grade 9</option><option value="grade10">Grade 10</option>
                            <option value="grade11">Grade 11</option><option value="grade12">Grade 12</option>
                        </select>
                    </div>
                </div>
                <div class="field-group" style="margin-top:13px;">
                    <label class="field-label" for="newStudentStartDate">Desired Start Date</label>
                    <input id="newStudentStartDate" type="date" class="field-input">
                </div>
            </div>

            <!-- Step 2: Subjects & Schedule -->
            <div class="step-panel" id="add-step-2">
                <h4 style="font-size:0.92rem;font-weight:800;color:var(--primary-xdark);margin:0 0 14px;">Step 2 ‚Äî Subjects &amp; Schedule</h4>
                <div class="field-group">
                    <label class="field-label">Academic Subjects (select all that apply)</label>
                    <div class="picker-grid" id="newStudentSubjects">
                        <span class="picker-chip" data-subject="Math" onclick="togglePickerChip(this)">Math</span>
                        <span class="picker-chip" data-subject="Language Arts" onclick="togglePickerChip(this)">Language Arts</span>
                        <span class="picker-chip" data-subject="Geography" onclick="togglePickerChip(this)">Geography</span>
                        <span class="picker-chip" data-subject="Science" onclick="togglePickerChip(this)">Science</span>
                        <span class="picker-chip" data-subject="Biology" onclick="togglePickerChip(this)">Biology</span>
                        <span class="picker-chip" data-subject="Physics" onclick="togglePickerChip(this)">Physics</span>
                        <span class="picker-chip" data-subject="Chemistry" onclick="togglePickerChip(this)">Chemistry</span>
                        <span class="picker-chip" data-subject="Microbiology" onclick="togglePickerChip(this)">Microbiology</span>
                    </div>
                </div>
                <div class="field-group">
                    <label class="field-label">Session Frequency *</label>
                    <div class="picker-grid" id="newStudentSessions">
                        <span class="picker-chip" data-sessions="twice" onclick="toggleSessionChip(this)">Twice weekly</span>
                        <span class="picker-chip" data-sessions="three" onclick="toggleSessionChip(this)">3√ó weekly</span>
                        <span class="picker-chip" data-sessions="five" onclick="toggleSessionChip(this)">Daily (5√ó)</span>
                    </div>
                    <div id="sessionFeesDisplay" style="margin-top:10px;font-size:0.8rem;color:var(--primary-dark);font-weight:600;background:rgba(22,163,74,0.08);padding:8px 12px;border-radius:8px;display:none;"></div>
                </div>
                <div class="field-group">
                    <label class="field-label">Preferred Days (select at least one)</label>
                    <div class="picker-grid" id="newStudentDays">
                        <span class="picker-chip" data-day="Monday" onclick="togglePickerChip(this)">Mon</span>
                        <span class="picker-chip" data-day="Tuesday" onclick="togglePickerChip(this)">Tue</span>
                        <span class="picker-chip" data-day="Wednesday" onclick="togglePickerChip(this)">Wed</span>
                        <span class="picker-chip" data-day="Thursday" onclick="togglePickerChip(this)">Thu</span>
                        <span class="picker-chip" data-day="Friday" onclick="togglePickerChip(this)">Fri</span>
                        <span class="picker-chip" data-day="Saturday" onclick="togglePickerChip(this)">Sat</span>
                        <span class="picker-chip" data-day="Sunday" onclick="togglePickerChip(this)">Sun</span>
                    </div>
                </div>
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:13px;">
                    <div class="field-group" style="margin:0;">
                        <label class="field-label" for="newStudentStartHour">Class Start Time</label>
                        <select id="newStudentStartHour" class="field-input">
                            <option value="">Select hour</option>
                            <option value="7">7:00 AM</option><option value="8">8:00 AM</option>
                            <option value="9">9:00 AM</option><option value="10">10:00 AM</option>
                            <option value="11">11:00 AM</option><option value="12">12:00 PM</option>
                            <option value="13">1:00 PM</option><option value="14">2:00 PM</option>
                            <option value="15">3:00 PM</option><option value="16">4:00 PM</option>
                            <option value="17">5:00 PM</option><option value="18">6:00 PM</option>
                            <option value="19">7:00 PM</option><option value="20">8:00 PM</option>
                        </select>
                    </div>
                    <div class="field-group" style="margin:0;">
                        <label class="field-label" for="newStudentEndHour">Class End Time</label>
                        <select id="newStudentEndHour" class="field-input">
                            <option value="">Select hour</option>
                            <option value="8">8:00 AM</option><option value="9">9:00 AM</option>
                            <option value="10">10:00 AM</option><option value="11">11:00 AM</option>
                            <option value="12">12:00 PM</option><option value="13">1:00 PM</option>
                            <option value="14">2:00 PM</option><option value="15">3:00 PM</option>
                            <option value="16">4:00 PM</option><option value="17">5:00 PM</option>
                            <option value="18">6:00 PM</option><option value="19">7:00 PM</option>
                            <option value="20">8:00 PM</option><option value="21">9:00 PM</option>
                        </select>
                    </div>
                </div>
                <div class="field-group" style="margin-top:13px;">
                    <label class="field-label" for="newStudentTutor">Tutor Preference</label>
                    <select id="newStudentTutor" class="field-input">
                        <option value="">No preference</option>
                        <option value="male">Male tutor</option>
                        <option value="female">Female tutor</option>
                    </select>
                </div>
            </div>

            <!-- Step 3: Fee Summary -->
            <div class="step-panel" id="add-step-3">
                <h4 style="font-size:0.92rem;font-weight:800;color:var(--primary-xdark);margin:0 0 14px;">Step 3 ‚Äî Fee Summary</h4>
                <p style="font-size:0.83rem;color:var(--text-muted);margin-bottom:16px;">Please review the estimated fees before confirming.</p>
                <div id="addStudentFeeSummary" style="background:linear-gradient(135deg,rgba(22,163,74,0.06),rgba(22,163,74,0.02));border:1px solid rgba(22,163,74,0.2);border-radius:var(--radius);padding:20px;margin-bottom:14px;">
                    <!-- populated dynamically by JS -->
                </div>
                <div style="background:#fefce8;border:1px solid #fde68a;border-radius:var(--radius);padding:13px;font-size:0.8rem;color:#92400e;">
                    <strong>‚ÑπÔ∏è Note:</strong> Fees are estimates. Final amounts confirmed by staff. Proration applies for mid-month starts.
                </div>
            </div>

            <!-- Step 4: Review & Submit -->
            <div class="step-panel" id="add-step-4">
                <h4 style="font-size:0.92rem;font-weight:800;color:var(--primary-xdark);margin:0 0 14px;">Step 4 ‚Äî Review &amp; Confirm</h4>
                <div id="addStudentReview" style="background:rgba(241,245,249,0.8);border:1px solid #e2e8f0;border-radius:var(--radius);padding:18px;font-size:0.87rem;line-height:1.75;color:#374151;"></div>
                <p style="margin-top:13px;font-size:0.78rem;color:#6b7280;">
                    ‚ÑπÔ∏è Your new student will be created as <strong>Pending Registration</strong>. Staff will review and confirm.
                </p>
            </div>
        </div>
        <div class="modal-footer" style="justify-content:space-between;">
            <button id="addStudentPrevBtn" class="btn-secondary" onclick="addStudentPrev()" style="width:auto;padding:11px 22px;display:none;">‚Üê Back</button>
            <div style="flex:1;"></div>
            <button id="addStudentNextBtn" class="btn-primary" onclick="addStudentNext()" style="width:auto;padding:11px 22px;">Next ‚Üí</button>
            <button id="addStudentSubmitBtn" class="btn-primary hidden" onclick="submitNewStudent()"
                    style="width:auto;padding:11px 22px;background:linear-gradient(135deg,var(--accent-light),var(--accent-dark));color:#3d1f00;box-shadow:0 4px 14px var(--accent-glow);">
                <span id="addStudentSubmitText">‚úÖ Submit Enrolment</span>
                <div id="addStudentSubmitSpinner" class="loading-spinner-small hidden"></div>
            </button>
        </div>
    </div>
</div>

<!-- Privacy / Terms Modal -->
<div id="privacyModal" class="modal-overlay hidden">
    <div class="modal-box modal-box-wide">
        <div class="modal-header">
            <h3 id="privacyModalTitle">üîí Privacy Policy</h3>
            <button class="modal-close" onclick="hidePrivacyModal()">√ó</button>
        </div>
        <div class="modal-body" id="privacyModalBody"></div>
        <div class="modal-footer">
            <button class="btn-primary" onclick="hidePrivacyModal()" style="max-width:180px;">I Understand</button>
        </div>
    </div>
</div>

<!-- Load parent portal JS -->
<script src="parent.js" defer></script>
</body>
</html>
