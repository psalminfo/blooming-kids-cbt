<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Parent Portal - Blooming Kids House</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" />
    <link rel="icon" href="favicon.ico" />

    <!-- Firebase SDKs (in correct order) -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    
    <!-- Your Firebase config -->
    <script src="firebaseParentConfig.js"></script>

    <!-- Other libraries -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
    
    <!-- Global Phone Number Support -->
    <script src="https://cdn.jsdelivr.net/npm/libphonenumber-js@1.9.6/bundle/libphonenumber-js.min.js"></script>

    <style>
        body {
            background: linear-gradient(135deg, #d1fae5 0%, #ecfdf5 50%, #d1fae5 100%);
            background-size: 400% 400%;
            animation: gradient 15s ease infinite;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
        }
        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        .logo-glow {
            filter: drop-shadow(0 0 15px rgba(34, 197, 94, 0.3));
        }
        .card-glow {
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        .btn-glow {
            box-shadow: 0 4px 6px -1px rgba(34, 197, 94, 0.3), 0 2px 4px -1px rgba(34, 197, 94, 0.1);
            transition: all 0.3s ease;
        }
        .btn-glow:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(34, 197, 94, 0.4), 0 4px 6px -2px rgba(34, 197, 94, 0.2);
        }
        .input-focus:focus {
            box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.1);
            border-color: #10b981;
        }
        .hidden { 
            display: none !important; 
        }
        /* Auth Tabs */
        .tab-active {
            background-color: #059669;
            color: white;
        }
        .tab-inactive {
            background-color: #d1fae5;
            color: #065f46;
        }
        /* Main Content Tabs */
        .tab-active-main {
            background-color: #10b981;
            color: white;
            position: relative;
        }
        .tab-inactive-main {
            background-color: #ecfdf5;
            color: #059669;
            position: relative;
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #10b981;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-right: 8px;
            vertical-align: middle;
        }
        .loading-spinner-small {
            border: 2px solid #f3f3f3;
            border-top: 2px solid #10b981;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            animation: spin 1s linear infinite;
            display: inline-block;
            vertical-align: middle;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transform: translateX(150%);
            transition: transform 0.3s ease;
        }
        .toast.show {
            transform: translateX(0);
        }
        .toast.success {
            background-color: #10b981;
        }
        .toast.error {
            background-color: #ef4444;
        }
        .toast.warning {
            background-color: #f59e0b;
        }
        .response-bubble {
            background-color: #f0fdf4;
            border: 1px solid #bbf7d0;
            border-radius: 12px;
            padding: 12px;
            margin-top: 8px;
        }
        .response-header {
            font-weight: 600;
            color: #065f46;
            margin-bottom: 4px;
        }
        /* Accordion Styles */
        .accordion-header {
            transition: all 0.3s ease;
        }
        .accordion-header:hover {
            background-color: #bbf7d0 !important;
        }
        /* Slide Down Animation */
        .slide-down {
            animation: slideDown 0.3s ease-out;
        }
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
                max-height: 0;
            }
            to {
                opacity: 1;
                transform: translateY(0);
                max-height: 5000px;
            }
        }
        .preserve-whitespace {
            white-space: pre-wrap;
            word-break: break-word;
        }
        /* Notification Badge */
        .notification-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background-color: #ef4444;
            color: white;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: bold;
            min-width: 1.25rem;
            height: 1.25rem;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 0.25rem;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        /* Message urgent styling */
        .urgent-message {
            border-left: 4px solid #ef4444;
            background-color: #fef2f2;
        }
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #a1a1a1;
        }
        /* Academics Section Specific */
        .academics-student-selector {
            background: linear-gradient(to right, #3b82f6, #1d4ed8);
            color: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .topic-item {
            transition: all 0.2s ease;
            border-left: 4px solid #3b82f6;
        }
        .topic-item:hover {
            transform: translateX(4px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);
        }
        .homework-item {
            transition: all 0.2s ease;
            border-left: 4px solid #8b5cf6;
        }
        .homework-item:hover {
            transform: translateX(4px);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.15);
        }
        .status-overdue {
            background-color: #fef2f2;
            color: #dc2626;
            border-color: #fca5a5;
        }
        .status-pending {
            background-color: #eff6ff;
            color: #1d4ed8;
            border-color: #93c5fd;
        }
        .status-submitted {
            background-color: #f0fdf4;
            color: #15803d;
            border-color: #86efac;
        }

        /* ============================================================
           GLOBAL DATA PRIVACY SYSTEM ‚Äî Blooming Kids House
           Covers: NDPA ¬∑ GDPR ¬∑ COPPA ¬∑ Cookie Consent ¬∑ Data Rights
           ============================================================ */

        /* --- Consent Banner --- */
        #privacyConsentBanner {
            position: fixed;
            bottom: 0; left: 0; right: 0;
            background: #fff;
            border-top: 3px solid #059669;
            box-shadow: 0 -4px 30px rgba(0,0,0,0.15);
            z-index: 9999;
            padding: 20px 24px;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 16px;
            animation: slideUpBanner 0.4s ease-out;
        }
        @keyframes slideUpBanner {
            from { transform: translateY(100%); opacity: 0; }
            to   { transform: translateY(0);    opacity: 1; }
        }
        #privacyConsentBanner .banner-text { flex: 1; min-width: 260px; font-size: 0.88rem; color: #374151; line-height: 1.5; }
        #privacyConsentBanner .banner-text strong { color: #065f46; }
        #privacyConsentBanner .banner-actions { display: flex; flex-wrap: wrap; gap: 10px; }
        .banner-btn-accept  { background:#059669; color:#fff; border:none; padding:10px 22px; border-radius:8px; font-weight:700; cursor:pointer; font-size:0.9rem; transition:background .2s; }
        .banner-btn-accept:hover  { background:#047857; }
        .banner-btn-manage  { background:#ecfdf5; color:#065f46; border:1.5px solid #6ee7b7; padding:10px 22px; border-radius:8px; font-weight:600; cursor:pointer; font-size:0.9rem; transition:all .2s; }
        .banner-btn-manage:hover  { background:#d1fae5; }
        .banner-btn-reject  { background:#fef2f2; color:#dc2626; border:1.5px solid #fca5a5; padding:10px 18px; border-radius:8px; font-weight:600; cursor:pointer; font-size:0.9rem; transition:all .2s; }
        .banner-btn-reject:hover  { background:#fee2e2; }

        /* --- Privacy Modals Shared --- */
        .privacy-overlay {
            position: fixed; inset: 0;
            background: rgba(0,0,0,0.55);
            z-index: 10000;
            display: flex; align-items: center; justify-content: center;
            padding: 16px;
        }
        .privacy-overlay.hidden { display: none !important; }
        .privacy-modal {
            background: #fff;
            border-radius: 20px;
            max-width: 780px; width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 25px 60px rgba(0,0,0,0.2);
            animation: fadeIn 0.3s ease;
        }
        .privacy-modal-header {
            background: linear-gradient(135deg, #065f46, #059669);
            color: #fff;
            padding: 24px 28px;
            border-radius: 20px 20px 0 0;
            display: flex; justify-content: space-between; align-items: center;
            position: sticky; top: 0; z-index: 1;
        }
        .privacy-modal-header h2 { font-size: 1.3rem; font-weight: 700; margin: 0; }
        .privacy-modal-header .badge { background: rgba(255,255,255,0.2); font-size: 0.72rem; padding: 3px 10px; border-radius: 20px; margin-left: 10px; }
        .privacy-close-btn { background: rgba(255,255,255,0.2); border: none; color: #fff; font-size: 1.4rem; width: 36px; height: 36px; border-radius: 50%; cursor: pointer; line-height: 1; transition: background .2s; }
        .privacy-close-btn:hover { background: rgba(255,255,255,0.35); }
        .privacy-modal-body { padding: 28px; }
        .privacy-section { margin-bottom: 28px; }
        .privacy-section h3 { font-size: 1.05rem; font-weight: 700; color: #065f46; margin-bottom: 10px; padding-bottom: 6px; border-bottom: 2px solid #d1fae5; display: flex; align-items: center; gap: 8px; }
        .privacy-section p, .privacy-section li { font-size: 0.9rem; color: #374151; line-height: 1.65; margin-bottom: 8px; }
        .privacy-section ul { padding-left: 18px; }
        .privacy-section ul li { list-style: disc; }
        .privacy-law-badges { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 20px; }
        .law-badge { padding: 5px 14px; border-radius: 20px; font-size: 0.78rem; font-weight: 700; }
        .law-badge.ndpa  { background: #ecfdf5; color: #065f46; border: 1.5px solid #6ee7b7; }
        .law-badge.gdpr  { background: #eff6ff; color: #1d4ed8; border: 1.5px solid #93c5fd; }
        .law-badge.coppa { background: #fdf4ff; color: #7c3aed; border: 1.5px solid #c4b5fd; }

        /* --- Toggle Switches (Consent Preferences) --- */
        .consent-toggle-row { display: flex; justify-content: space-between; align-items: center; padding: 14px 0; border-bottom: 1px solid #f3f4f6; }
        .consent-toggle-row:last-child { border-bottom: none; }
        .consent-toggle-info h4 { font-size: 0.92rem; font-weight: 600; color: #111827; margin-bottom: 2px; }
        .consent-toggle-info p  { font-size: 0.8rem; color: #6b7280; margin: 0; }
        .toggle-switch { position: relative; width: 48px; height: 26px; flex-shrink: 0; }
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .toggle-slider { position: absolute; inset: 0; background: #d1d5db; border-radius: 34px; cursor: pointer; transition: .3s; }
        .toggle-slider:before { content:""; position:absolute; height:20px; width:20px; left:3px; bottom:3px; background:#fff; border-radius:50%; transition:.3s; }
        input:checked + .toggle-slider { background: #059669; }
        input:checked + .toggle-slider:before { transform: translateX(22px); }
        .toggle-switch.disabled-toggle .toggle-slider { cursor: not-allowed; opacity: 0.7; }

        /* --- Data Rights Form --- */
        .rights-card { background: #f9fafb; border: 1.5px solid #e5e7eb; border-radius: 14px; padding: 20px; margin-bottom: 16px; cursor: pointer; transition: all .2s; }
        .rights-card:hover { border-color: #6ee7b7; background: #f0fdf4; }
        .rights-card.selected { border-color: #059669; background: #ecfdf5; }
        .rights-card h4 { font-size: 0.95rem; font-weight: 700; color: #065f46; margin-bottom: 4px; display: flex; align-items: center; gap: 8px; }
        .rights-card p  { font-size: 0.82rem; color: #6b7280; margin: 0; }
        .rights-form-group { margin-bottom: 16px; }
        .rights-form-group label { display: block; font-size: 0.85rem; font-weight: 600; color: #374151; margin-bottom: 6px; }
        .rights-form-group input, .rights-form-group select, .rights-form-group textarea {
            width: 100%; padding: 10px 14px; border: 1.5px solid #d1d5db; border-radius: 10px;
            font-size: 0.88rem; font-family: inherit; transition: border-color .2s;
            outline: none; background: #fff; box-sizing: border-box;
        }
        .rights-form-group input:focus, .rights-form-group select:focus, .rights-form-group textarea:focus { border-color: #059669; box-shadow: 0 0 0 3px rgba(5,150,105,0.1); }
        .rights-submit-btn { width:100%; background:#059669; color:#fff; border:none; padding:13px; border-radius:12px; font-weight:700; font-size:0.95rem; cursor:pointer; transition:background .2s; margin-top:8px; }
        .rights-submit-btn:hover { background:#047857; }
        .rights-success-box { background: #ecfdf5; border: 1.5px solid #6ee7b7; border-radius: 12px; padding: 20px; text-align: center; }
        .rights-success-box .check-icon { font-size: 2.5rem; margin-bottom: 8px; }
        .rights-success-box h4 { color: #065f46; font-weight: 700; margin-bottom: 6px; }
        .rights-success-box p { color: #374151; font-size: 0.88rem; margin: 0; }

        /* --- Privacy Floating Button --- */
        #privacyFloatingBtn {
            position: fixed; bottom: 24px; left: 24px;
            background: #059669; color: #fff;
            border: none; border-radius: 50px;
            padding: 10px 18px; font-size: 0.82rem; font-weight: 700;
            cursor: pointer; z-index: 9000;
            box-shadow: 0 4px 16px rgba(5,150,105,0.35);
            display: flex; align-items: center; gap: 6px;
            transition: all .2s;
        }
        #privacyFloatingBtn:hover { background: #047857; transform: translateY(-2px); box-shadow: 0 8px 20px rgba(5,150,105,0.4); }

        /* --- Consent Checkbox (sign-up) --- */
        .privacy-consent-check { display: flex; align-items: flex-start; gap: 10px; background: #f0fdf4; border: 1.5px solid #bbf7d0; border-radius: 10px; padding: 12px 14px; }
        .privacy-consent-check input[type="checkbox"] { margin-top: 2px; width: 16px; height: 16px; flex-shrink: 0; accent-color: #059669; cursor: pointer; }
        .privacy-consent-check label { font-size: 0.85rem; color: #374151; line-height: 1.5; cursor: pointer; }
        .privacy-consent-check label a, .privacy-consent-check label span.link { color: #059669; font-weight: 600; cursor: pointer; text-decoration: underline; }

        /* --- Age Verification (COPPA) --- */
        .coppa-box { background: #fdf4ff; border: 1.5px solid #c4b5fd; border-radius: 12px; padding: 16px; margin-bottom: 12px; }
        .coppa-box h4 { color: #7c3aed; font-weight: 700; font-size: 0.9rem; margin-bottom: 6px; display: flex; align-items: center; gap: 6px; }
        .coppa-box p { font-size: 0.82rem; color: #4b5563; margin: 0; }

        /* --- Data Retention Info --- */
        .retention-table { width: 100%; border-collapse: collapse; font-size: 0.85rem; margin-top: 10px; }
        .retention-table th { background: #ecfdf5; color: #065f46; padding: 8px 12px; text-align: left; font-weight: 700; border: 1px solid #d1fae5; }
        .retention-table td { padding: 8px 12px; border: 1px solid #e5e7eb; color: #374151; }
        .retention-table tr:nth-child(even) td { background: #f9fafb; }

        /* --- Privacy footer note in modals --- */
        .privacy-modal-footer { padding: 16px 28px; border-top: 1px solid #e5e7eb; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px; }
        .privacy-modal-footer span { font-size: 0.8rem; color: #9ca3af; }
        .privacy-modal-footer a { font-size: 0.8rem; color: #059669; cursor: pointer; font-weight: 600; }
    </style>
</head>
<body class="flex flex-col items-center p-4">
    <div id="toastContainer"></div>

    <div class="w-full max-w-6xl">
        <div class="text-center mb-8">
            <img src="https://res.cloudinary.com/dy2hxcyaf/image/upload/v1757700806/newbhlogo_umwqzy.svg" 
                 alt="Blooming Kids House Logo" 
                 class="h-20 w-auto mx-auto logo-glow mb-4">
            <h1 class="text-4xl font-bold text-green-800 mb-2">Parent Portal</h1>
            <p class="text-green-600 text-lg">Secure Access to Your Children's Progress Reports</p>
        </div>

        <div id="authArea" class="bg-white rounded-2xl card-glow p-8 mb-8 fade-in">
            <div class="flex mb-6 rounded-xl overflow-hidden border border-green-200">
                <button id="signInTab" class="flex-1 py-3 font-semibold tab-active transition-all duration-200">
                    Sign In
                </button>
                <button id="signUpTab" class="flex-1 py-3 font-semibold tab-inactive transition-all duration-200">
                    Sign Up
                </button>
            </div>

            <div id="signInForm">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">Welcome Back</h2>
                
                <div class="space-y-4">
                    <div>
                        <label for="loginIdentifier" class="block text-sm font-medium text-gray-700 mb-2">
                            Phone Number or Email
                        </label>
                        <input id="loginIdentifier" 
                               type="text" 
                               placeholder="Enter your phone number or email"
                               class="w-full px-4 py-3 border border-gray-300 rounded-xl input-focus focus:outline-none transition-all duration-200"
                               required>
                    </div>
                    
                    <div>
                        <label for="loginPassword" class="block text-sm font-medium text-gray-700 mb-2">
                            Password
                        </label>
                        <input id="loginPassword" 
                               type="password" 
                               placeholder="Enter your password"
                               class="w-full px-4 py-3 border border-gray-300 rounded-xl input-focus focus:outline-none transition-all duration-200"
                               required>
                    </div>

                    <div class="flex items-center">
                        <input id="rememberMe" type="checkbox" class="h-4 w-4 text-green-600 focus:ring-green-500 border-gray-300 rounded">
                        <label for="rememberMe" class="ml-2 block text-sm text-gray-700">
                            Remember me
                        </label>
                    </div>
                    
                    <button id="signInBtn" 
                            class="w-full bg-green-600 text-white py-3 rounded-xl font-semibold btn-glow hover:bg-green-700 transition-all duration-200 flex justify-center items-center">
                        <span id="signInText">Sign In</span>
                        <div id="signInSpinner" class="loading-spinner hidden"></div>
                    </button>

                    <div class="text-center">
                        <button id="forgotPasswordBtn" class="text-green-600 hover:text-green-800 text-sm transition-colors duration-200">
                            Forgot Password?
                        </button>
                    </div>
                </div>
            </div>

            <div id="signUpForm" class="hidden">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">Create Account</h2>
                
                <div class="space-y-4">
                    <div>
                        <label for="signupPhone" class="block text-sm font-medium text-gray-700 mb-2">
                            Phone Number
                        </label>
                        <div id="phoneInputContainer">
                            <!-- Country code dropdown will be inserted here by JavaScript -->
                            <input id="signupPhone" 
                                   type="tel" 
                                   placeholder="Enter your phone number (any format)"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-xl input-focus focus:outline-none transition-all duration-200"
                                   required>
                        </div>
                    </div>
                    
                    <div>
                        <label for="signupEmail" class="block text-sm font-medium text-gray-700 mb-2">
                            Email Address
                        </label>
                        <input id="signupEmail" 
                               type="email" 
                               placeholder="Enter your email address"
                               class="w-full px-4 py-3 border border-gray-300 rounded-xl input-focus focus:outline-none transition-all duration-200"
                               required>
                    </div>
                    
                    <div>
                        <label for="signupPassword" class="block text-sm font-medium text-gray-700 mb-2">
                            Password
                        </label>
                        <input id="signupPassword" 
                               type="password" 
                               placeholder="Minimum 6 characters"
                               class="w-full px-4 py-3 border border-gray-300 rounded-xl input-focus focus:outline-none transition-all duration-200"
                               required minlength="6">
                    </div>
                    
                    <div>
                        <label for="signupConfirmPassword" class="block text-sm font-medium text-gray-700 mb-2">
                            Confirm Password
                        </label>
                        <input id="signupConfirmPassword" 
                               type="password" 
                               placeholder="Confirm your password"
                               class="w-full px-4 py-3 border border-gray-300 rounded-xl input-focus focus:outline-none transition-all duration-200"
                               required minlength="6">
                    </div>
                    
                    <!-- COPPA Notice -->
                    <div class="coppa-box">
                        <h4>üõ°Ô∏è Child Data Protection (COPPA)</h4>
                        <p>By registering, you confirm you are a parent or legal guardian aged 18+, and you provide verifiable parental consent for any student data associated with your account. Children under 13 are protected under COPPA.</p>
                    </div>
                    <!-- Privacy Consent -->
                    <div class="privacy-consent-check">
                        <input type="checkbox" id="privacyConsentCheck" required>
                        <label for="privacyConsentCheck">
                            I have read and agree to the <span class="link" onclick="openPrivacyPolicy()">Privacy Policy</span> and
                            <span class="link" onclick="openConsentPreferences()">Data Processing Terms</span>.
                            I understand my data is processed under NDPA, GDPR &amp; COPPA. I consent to collection of contact details, student academic data, and referral tracking for educational service purposes.
                        </label>
                    </div>
                    <button id="signUpBtn" 
                            class="w-full bg-green-600 text-white py-3 rounded-xl font-semibold btn-glow hover:bg-green-700 transition-all duration-200 flex justify-center items-center">
                        <span id="signUpText">Create Account</span>
                        <div id="signUpSpinner" class="loading-spinner hidden"></div>
                    </button>
                </div>
            </div>
            
            <div id="authLoader" class="hidden text-center mt-4">
                <div class="loading-spinner"></div>
                <p class="text-green-600 font-semibold mt-2">Processing... Please wait.</p>
            </div>
        </div>

        <div id="reportArea" class="hidden fade-in">
            <div class="bg-green-50 border-l-4 border-green-600 p-6 rounded-lg mb-6">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                    <div>
                        <h2 id="welcomeMessage" class="text-2xl font-bold text-green-800">Welcome!</h2>
                        <p class="text-green-600">Thank you for being part of Blooming Kids House family</p>
                    </div>
                    <div class="flex flex-col sm:flex-row gap-2 w-full md:w-auto">
                        <!-- Buttons will be added here by JavaScript -->
                        <button onclick="logout()" 
                                class="bg-red-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-red-700 transition-all duration-200 btn-glow flex items-center justify-center">
                            <span class="mr-2">üö™</span> Logout
                        </button>
                    </div>
                </div>
            </div>

            <div class="flex mb-6 rounded-xl overflow-hidden shadow-lg border border-green-200 flex-wrap">
                <button id="reportTab" onclick="switchMainTab('reports')" class="flex-1 py-3 font-semibold tab-active-main hover:bg-green-500 transition-all duration-200" style="min-width:120px">
                    <span class="mr-1">üìÑ</span><span class="hidden sm:inline">Progress</span> Reports
                </button>
                <button id="academicsTab" onclick="switchMainTab('academics')" class="flex-1 py-3 font-semibold tab-inactive-main hover:bg-green-100 transition-all duration-200 relative" style="min-width:100px">
                    <span class="mr-1">üìö</span> Academics
                </button>
                <button id="messagesTab" onclick="switchMainTab('messages')" class="flex-1 py-3 font-semibold tab-inactive-main hover:bg-green-100 transition-all duration-200 relative" style="min-width:100px">
                    <span class="mr-1">üí¨</span> Messages
                    <span id="msgUnreadBadge" class="hidden absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full min-w-5 h-5 flex items-center justify-center font-bold px-1" style="font-size:0.65rem;line-height:1rem;"></span>
                </button>
                <button id="enrollTab" onclick="switchMainTab('enroll')" class="flex-1 py-3 font-semibold tab-inactive-main hover:bg-green-100 transition-all duration-200" style="min-width:120px">
                    <span class="mr-1">‚ûï</span> Add Student
                </button>
                <button id="rewardsTab" onclick="switchMainTab('rewards')" class="flex-1 py-3 font-semibold tab-inactive-main hover:bg-green-100 transition-all duration-200" style="min-width:100px">
                    <span class="mr-1">üéÅ</span> Rewards
                </button>
            </div>

            <div id="reportContentArea">
                <h2 class="text-2xl font-bold text-green-800 mb-6">Your Children's Reports</h2>
                
                <div id="reportsLoading" class="hidden text-center py-8">
                    <div class="loading-spinner mx-auto" style="width: 40px; height: 40px;"></div>
                    <p class="text-green-600 font-semibold mt-4">Loading reports...</p>
                </div>
                
                <div id="reportsEmpty" class="hidden text-center py-12 bg-white rounded-xl card-glow">
                    <div class="text-6xl mb-4">üì¨</div>
                    <h3 class="text-xl font-bold text-gray-700 mb-2">No Reports Available</h3>
                    <p class="text-gray-500 max-w-md mx-auto">No progress reports are available for your children at this time. Please check back later.</p>
                </div>
                
                <div id="reportContent" class="space-y-6">
                    <!-- Accordion reports will be inserted here by JavaScript -->
                </div>
            </div>
            
            <div id="academicsContentArea" class="hidden">
                <h2 class="text-2xl font-bold text-green-800 mb-6">Academic Progress & Assignments</h2>
                
                <!-- Student Selection Dropdown Container -->
                <div id="academicsStudentDropdown" class="mb-6">
                    <!-- Student dropdown will be inserted here by JavaScript -->
                </div>
                
                <div id="academicsContent" class="bg-white rounded-xl card-glow p-6 min-h-[400px]">
                    <!-- Academics data will be inserted here by JavaScript -->
                </div>
            </div>
            
            <div id="rewardsContentArea" class="hidden">
                <h2 class="text-2xl font-bold text-green-800 mb-6">Parent Referral Rewards</h2>
                <div id="rewardsContent" class="bg-white rounded-xl card-glow p-6 min-h-[400px]">
                    <!-- Rewards data will be inserted here by JavaScript -->
                </div>
            </div>

            <!-- ============================================================ -->
            <!-- MESSAGES TAB CONTENT                                          -->
            <!-- ============================================================ -->
            <div id="messagesContentArea" class="hidden">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-2xl font-bold text-green-800">üí¨ Messages</h2>
                    <button onclick="openNewMessageModal()" class="bg-green-600 text-white px-5 py-2.5 rounded-xl font-semibold hover:bg-green-700 transition-all duration-200 btn-glow flex items-center gap-2 text-sm">
                        <span>‚úèÔ∏è</span> New Message
                    </button>
                </div>
                <div class="bg-white rounded-2xl card-glow overflow-hidden" style="min-height:520px;display:flex;">
                    <!-- Conversation List (left pane) -->
                    <div id="msgConvList" style="width:280px;min-width:200px;border-right:1px solid #e5e7eb;display:flex;flex-direction:column;background:#fff;">
                        <div style="padding:14px 16px;border-bottom:1px solid #f3f4f6;background:#f9fafb;">
                            <p style="font-weight:700;font-size:0.9rem;color:#1f2937;">Conversations</p>
                        </div>
                        <div id="msgConvListInner" style="flex:1;overflow-y:auto;">
                            <div class="text-center py-8 text-gray-400 text-sm">Loading conversations‚Ä¶</div>
                        </div>
                    </div>
                    <!-- Chat View (right pane) -->
                    <div style="flex:1;display:flex;flex-direction:column;background:#f9fafb;">
                        <div id="msgChatHeader" style="padding:12px 18px;border-bottom:1px solid #e5e7eb;background:#fff;display:flex;align-items:center;gap:10px;">
                            <div id="msgChatTitle" style="font-weight:700;color:#1f2937;font-size:0.95rem;">Select a conversation</div>
                        </div>
                        <div id="msgChatMessages" style="flex:1;overflow-y:auto;padding:16px;display:flex;flex-direction:column;gap:8px;">
                            <div class="text-center text-gray-400 py-16">
                                <div style="font-size:3rem;margin-bottom:12px;">üí¨</div>
                                <p>Select a conversation to start chatting</p>
                            </div>
                        </div>
                        <div id="msgChatInputArea" style="border-top:1px solid #e5e7eb;padding:12px 14px;background:#fff;display:none;align-items:flex-end;gap:8px;">
                            <textarea id="msgChatInput" rows="2" placeholder="Type a message‚Ä¶" style="flex:1;border:1.5px solid #d1d5db;border-radius:10px;padding:9px 12px;resize:none;font-size:0.875rem;outline:none;font-family:inherit;" onfocus="this.style.borderColor='#10b981'" onblur="this.style.borderColor='#d1d5db'"></textarea>
                            <label style="cursor:pointer;padding:8px;border-radius:8px;background:#f3f4f6;font-size:1rem;" title="Attach image">
                                üìé <input type="file" id="msgChatImageFile" accept="image/*" style="display:none;">
                            </label>
                            <button id="msgChatSendBtn" onclick="parentSendChatMessage()" style="background:#10b981;color:#fff;border:none;border-radius:10px;padding:9px 16px;cursor:pointer;font-weight:700;font-size:0.9rem;">‚û§</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ============================================================ -->
            <!-- ENROLL STUDENT TAB CONTENT                                    -->
            <!-- ============================================================ -->
            <div id="enrollContentArea" class="hidden">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-2xl font-bold text-green-800">‚ûï Add a New Student</h2>
                    <div class="text-sm text-gray-500 bg-green-50 border border-green-200 px-4 py-2 rounded-lg">
                        <span class="text-green-700 font-semibold">Parent info pre-filled</span> from your account
                    </div>
                </div>
                <div id="enrollFormContainer" class="bg-white rounded-2xl card-glow p-6 md:p-8">
                    <div id="enrollFormContent">
                        <!-- Will be rendered by JavaScript -->
                        <div class="text-center py-12"><div class="loading-spinner mx-auto" style="width:36px;height:36px;"></div><p class="text-green-600 mt-3">Loading enrollment form‚Ä¶</p></div>
                    </div>
                    <!-- Success screen (hidden initially) -->
                    <div id="enrollSuccessScreen" class="hidden text-center py-12">
                        <div style="font-size:4rem;margin-bottom:16px;">üéâ</div>
                        <h3 class="text-2xl font-bold text-green-800 mb-3">Application Submitted!</h3>
                        <p class="text-gray-600 mb-2">Your new student enrollment request has been received.</p>
                        <p class="text-gray-500 text-sm mb-6">Our team will review and contact you within 24‚Äì48 hours.</p>
                        <div id="enrollAppIdDisplay" class="bg-green-50 border border-green-200 rounded-xl p-4 mb-6 inline-block">
                            <p class="text-xs text-green-600 font-semibold uppercase tracking-wider mb-1">Application ID</p>
                            <p id="enrollAppId" class="text-xl font-bold text-green-800 font-mono"></p>
                        </div>
                        <div class="flex justify-center gap-4">
                            <button onclick="resetEnrollForm()" class="bg-green-600 text-white px-6 py-3 rounded-xl font-semibold hover:bg-green-700 transition-all duration-200">
                                ‚ûï Add Another Student
                            </button>
                            <button onclick="switchMainTab('reports')" class="bg-gray-600 text-white px-6 py-3 rounded-xl font-semibold hover:bg-gray-700 transition-all duration-200">
                                ‚Üê Back to Dashboard
                            </button>
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <!-- New Message Modal (dynamically created by JS) -->
        <!-- ============================================================ -->
        <div id="feedbackModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50 p-4">
            <div class="bg-white rounded-2xl p-6 md:p-8 max-w-2xl w-full mx-auto card-glow max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-bold text-gray-800">Send Feedback</h3>
                    <button onclick="hideFeedbackModal()" class="text-gray-500 hover:text-gray-700 text-2xl">
                        &times;
                    </button>
                </div>
                
                <p class="text-gray-600 mb-6">We value your feedback! Please fill out the form below.</p>
                
                <div class="space-y-4">
                    <div>
                        <label for="feedbackCategory" class="block text-sm font-medium text-gray-700 mb-2">
                            Category *
                        </label>
                        <select id="feedbackCategory" 
                                class="w-full px-4 py-3 border border-gray-300 rounded-xl input-focus focus:outline-none transition-all duration-200"
                                required>
                            <option value="">Select category</option>
                            <option value="Feedback">General Feedback</option>
                            <option value="Request">Special Request</option>
                            <option value="Complaint">Complaint</option>
                            <option value="Suggestion">Suggestion</option>
                        </select>
                    </div>

                    <div>
                        <label for="feedbackPriority" class="block text-sm font-medium text-gray-700 mb-2">
                            Priority *
                        </label>
                        <select id="feedbackPriority" 
                                class="w-full px-4 py-3 border border-gray-300 rounded-xl input-focus focus:outline-none transition-all duration-200"
                                required>
                            <option value="">Select priority</option>
                            <option value="Low">Low</option>
                            <option value="Medium">Medium</option>
                            <option value="High">High</option>
                            <option value="Urgent">Urgent</option>
                        </select>
                    </div>

                    <div>
                        <label for="feedbackStudent" class="block text-sm font-medium text-gray-700 mb-2">
                            Regarding Student *
                        </label>
                        <select id="feedbackStudent" 
                                class="w-full px-4 py-3 border border-gray-300 rounded-xl input-focus focus:outline-none transition-all duration-200"
                                required>
                            <option value="">Select student</option>
                        </select>
                    </div>

                    <div>
                        <label for="feedbackMessage" class="block text-sm font-medium text-gray-700 mb-2">
                            Your Message *
                        </label>
                        <textarea id="feedbackMessage" 
                                  rows="6"
                                  placeholder="Please provide details about your feedback..."
                                  class="w-full px-4 py-3 border border-gray-300 rounded-xl input-focus focus:outline-none transition-all duration-200 preserve-whitespace"
                                  required></textarea>
                    </div>
                    
                    <div class="flex flex-col sm:flex-row gap-2 pt-4">
                        <button id="submitFeedbackBtn" 
                                class="flex-1 bg-green-600 text-white py-3 rounded-xl font-semibold btn-glow hover:bg-green-700 transition-all duration-200 flex justify-center items-center">
                            <span id="submitFeedbackText">Submit Feedback</span>
                            <div id="submitFeedbackSpinner" class="loading-spinner hidden"></div>
                        </button>
                        <button onclick="hideFeedbackModal()" 
                                class="flex-1 bg-gray-500 text-white py-3 rounded-xl font-semibold hover:bg-gray-600 transition-all duration-200">
                            Cancel
                        </button>
                    </div>
                </div>

                <div class="mt-6 text-center">
                    <p class="text-sm text-gray-500">
                        Your feedback is important to us. We'll respond within 24-48 hours.
                    </p>
                </div>
            </div>
        </div>

        <!-- Admin Responses Modal -->
        <div id="responsesModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50 p-4">
            <div class="bg-white rounded-2xl p-6 md:p-8 max-w-4xl w-full mx-auto card-glow max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-bold text-gray-800">üì® Admin Responses</h3>
                    <button onclick="hideResponsesModal()" class="text-gray-500 hover:text-gray-700 text-2xl">
                        &times;
                    </button>
                </div>
                
                <p class="text-gray-600 mb-6">Responses from our staff to your feedback.</p>
                
                <div id="responsesContent" class="space-y-4">
                    <!-- Responses will be inserted here by JavaScript -->
                </div>

                <div class="mt-6 text-center">
                    <button onclick="hideResponsesModal()" 
                            class="bg-gray-500 text-white px-6 py-3 rounded-lg font-semibold hover:bg-gray-600 transition-all duration-200">
                        Close
                    </button>
                </div>
            </div>
        </div>

        <div id="passwordResetModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50 p-4">
            <div class="bg-white rounded-2xl p-6 md:p-8 max-w-md w-full mx-auto card-glow">
                <h3 class="text-2xl font-bold text-gray-800 mb-4 text-center">Reset Password</h3>
                <p class="text-gray-600 mb-4 text-center">Enter your email address to receive a password reset link.</p>
                
                <div class="space-y-4">
                    <div>
                        <label for="resetEmail" class="block text-sm font-medium text-gray-700 mb-2">
                            Email Address
                        </label>
                        <input id="resetEmail" 
                               type="email" 
                               placeholder="Enter your registered email"
                               class="w-full px-4 py-3 border border-gray-300 rounded-xl input-focus focus:outline-none transition-all duration-200"
                               required>
                    </div>
                    
                    <div class="flex flex-col sm:flex-row gap-2">
                        <button id="sendResetBtn" 
                                class="flex-1 bg-green-600 text-white py-3 rounded-xl font-semibold btn-glow hover:bg-green-700 transition-all duration-200 flex justify-center items-center">
                            <span id="sendResetText">Send Reset Link</span>
                            <div id="sendResetSpinner" class="loading-spinner hidden"></div>
                        </button>
                        <button id="cancelResetBtn" 
                                class="flex-1 bg-gray-500 text-white py-3 rounded-xl font-semibold hover:bg-gray-600 transition-all duration-200">
                            Cancel
                        </button>
                    </div>
                </div>
                
                <div id="resetLoader" class="hidden text-center mt-4">
                    <div class="loading-spinner mx-auto"></div>
                    <p class="text-green-600 font-semibold mt-2">Sending reset link...</p>
                </div>
            </div>
        </div>

        <div class="text-center mt-12">
            <p class="text-green-800 font-semibold">BLOOMING KIDS HOUSE</p>
            <p class="text-green-600 text-sm">Where Every Child Blossoms</p>
        </div>
    </div>

    <script src="parent.js"></script>
    <script src="parent_additions.js"></script>

    <!-- ================================================================
         GLOBAL DATA PRIVACY SYSTEM ‚Äî All HTML, JS self-contained below
         ================================================================ -->

    <!-- Floating Privacy Button -->
    <button id="privacyFloatingBtn" onclick="openPrivacyHub()" title="Privacy & Data Rights">
        üîí Privacy &amp; Data Rights
    </button>

    <!-- ‚ë† COOKIE / CONSENT BANNER -->
    <div id="privacyConsentBanner" class="hidden">
        <div class="banner-text">
            <strong>üç™ We value your privacy.</strong> Blooming Kids House uses essential cookies for secure authentication and optional analytics cookies to improve your experience.
            We process your data under the <strong>Nigeria Data Protection Act (NDPA)</strong>, <strong>GDPR</strong>, and <strong>COPPA</strong>.
            <span onclick="openPrivacyPolicy()" style="color:#059669;font-weight:600;cursor:pointer;text-decoration:underline;">Read our full Privacy Policy ‚Üí</span>
        </div>
        <div class="banner-actions">
            <button class="banner-btn-accept" onclick="acceptAllCookies()">‚úì Accept All</button>
            <button class="banner-btn-manage" onclick="openConsentPreferences()">‚öô Manage Preferences</button>
            <button class="banner-btn-reject" onclick="rejectOptionalCookies()">‚úó Essential Only</button>
        </div>
    </div>

    <!-- ‚ë° PRIVACY HUB MODAL (Central Navigation) -->
    <div id="privacyHubModal" class="privacy-overlay hidden">
        <div class="privacy-modal" style="max-width:560px;">
            <div class="privacy-modal-header">
                <div>
                    <h2>üîí Privacy &amp; Data Rights Centre</h2>
                    <div style="font-size:0.8rem;opacity:0.85;margin-top:4px;">Blooming Kids House ‚Äî Parent Portal</div>
                </div>
                <button class="privacy-close-btn" onclick="closeModal('privacyHubModal')">&times;</button>
            </div>
            <div class="privacy-modal-body">
                <div class="privacy-law-badges">
                    <span class="law-badge ndpa">üá≥üá¨ NDPA Compliant</span>
                    <span class="law-badge gdpr">üá™üá∫ GDPR Compliant</span>
                    <span class="law-badge coppa">üë∂ COPPA Protected</span>
                </div>
                <p style="font-size:0.9rem;color:#4b5563;margin-bottom:24px;">Your privacy matters to us. From here you can review our policies, manage what data we collect, and exercise your legal rights over your personal information.</p>
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
                    <button onclick="closeModal('privacyHubModal');openPrivacyPolicy()" style="background:#ecfdf5;border:1.5px solid #6ee7b7;border-radius:14px;padding:18px;text-align:left;cursor:pointer;transition:all .2s;" onmouseover="this.style.background='#d1fae5'" onmouseout="this.style.background='#ecfdf5'">
                        <div style="font-size:1.8rem;margin-bottom:8px;">üìú</div>
                        <div style="font-weight:700;color:#065f46;font-size:0.92rem;">Privacy Policy</div>
                        <div style="font-size:0.78rem;color:#6b7280;margin-top:2px;">Full policy covering all portals</div>
                    </button>
                    <button onclick="closeModal('privacyHubModal');openConsentPreferences()" style="background:#eff6ff;border:1.5px solid #93c5fd;border-radius:14px;padding:18px;text-align:left;cursor:pointer;transition:all .2s;" onmouseover="this.style.background='#dbeafe'" onmouseout="this.style.background='#eff6ff'">
                        <div style="font-size:1.8rem;margin-bottom:8px;">‚öôÔ∏è</div>
                        <div style="font-weight:700;color:#1d4ed8;font-size:0.92rem;">Consent Preferences</div>
                        <div style="font-size:0.78rem;color:#6b7280;margin-top:2px;">Manage what we collect</div>
                    </button>
                    <button onclick="closeModal('privacyHubModal');openDataRights()" style="background:#fdf4ff;border:1.5px solid #c4b5fd;border-radius:14px;padding:18px;text-align:left;cursor:pointer;transition:all .2s;" onmouseover="this.style.background='#f3e8ff'" onmouseout="this.style.background='#fdf4ff'">
                        <div style="font-size:1.8rem;margin-bottom:8px;">‚öñÔ∏è</div>
                        <div style="font-weight:700;color:#7c3aed;font-size:0.92rem;">My Data Rights</div>
                        <div style="font-size:0.78rem;color:#6b7280;margin-top:2px;">Access, correct or delete data</div>
                    </button>
                    <button onclick="closeModal('privacyHubModal');openDataRetention()" style="background:#fff7ed;border:1.5px solid #fed7aa;border-radius:14px;padding:18px;text-align:left;cursor:pointer;transition:all .2s;" onmouseover="this.style.background='#ffedd5'" onmouseout="this.style.background='#fff7ed'">
                        <div style="font-size:1.8rem;margin-bottom:8px;">üìÖ</div>
                        <div style="font-weight:700;color:#c2410c;font-size:0.92rem;">Data Retention</div>
                        <div style="font-size:0.78rem;color:#6b7280;margin-top:2px;">How long we keep your data</div>
                    </button>
                </div>
                <div style="margin-top:20px;background:#fef2f2;border:1.5px solid #fca5a5;border-radius:12px;padding:14px;font-size:0.83rem;color:#991b1b;">
                    <strong>‚ö†Ô∏è Withdraw Consent:</strong> You may withdraw consent at any time by contacting <a href="/cdn-cgi/l/email-protection#442d2a222b0426282b2b292d2a232f2d20372c2b3137216a272b29" style="color:#059669;font-weight:600;"><span class="__cf_email__" data-cfemail="97fef9f1f8d7f5fbf8f8fafef9f0fcfef3e4fff8e2e4f2b9f4f8fa">[email&#160;protected]</span></a>. Note that withdrawing consent may affect access to certain platform features.
                </div>
            </div>
            <div class="privacy-modal-footer">
                <span>Last Updated: February 24, 2026</span>
                <span>DPO: <a href="/cdn-cgi/l/email-protection#84edeae2ebc4e6e8ebebe9edeae3efede0f7ecebf1f7e1aae7ebe9"><span class="__cf_email__" data-cfemail="e48d8a828ba486888b8b898d8a838f8d80978c8b919781ca878b89">[email&#160;protected]</span></a></span>
            </div>
        </div>
    </div>

    <!-- ‚ë¢ FULL PRIVACY POLICY MODAL -->
    <div id="privacyPolicyModal" class="privacy-overlay hidden">
        <div class="privacy-modal">
            <div class="privacy-modal-header">
                <div>
                    <h2>üìú Privacy Policy <span class="badge">v2.0</span></h2>
                    <div style="font-size:0.8rem;opacity:0.85;margin-top:4px;">Last Updated: February 24, 2026</div>
                </div>
                <button class="privacy-close-btn" onclick="closeModal('privacyPolicyModal')">&times;</button>
            </div>
            <div class="privacy-modal-body">
                <div class="privacy-law-badges">
                    <span class="law-badge ndpa">üá≥üá¨ Nigeria Data Protection Act</span>
                    <span class="law-badge gdpr">üá™üá∫ GDPR (EU) 2016/679</span>
                    <span class="law-badge coppa">üë∂ COPPA (USA)</span>
                </div>

                <div class="privacy-section">
                    <h3>üè¢ 1. Data Controller &amp; Identity</h3>
                    <p><strong>Blooming Kids House</strong> is the Data Controller for all personal information processed through this platform. Our multi-portal educational platform operates under Nigerian law while serving an international community.</p>
                    <p><strong>Data Protection Officer (DPO):</strong> Available at <a href="/cdn-cgi/l/email-protection#3f565159507f5d5350505256515854565b4c57504a4c5a115c5052" style="color:#059669;"><span class="__cf_email__" data-cfemail="a6cfc8c0c9e6c4cac9c9cbcfc8c1cdcfc2d5cec9d3d5c388c5c9cb">[email&#160;protected]</span></a></p>
                    <p><strong>Platform Infrastructure:</strong> Google Firebase / Firestore (Google Cloud, located in Belgium ‚Äî EU servers). Google LLC acts as a Data Processor under a Data Processing Agreement compliant with Standard Contractual Clauses (SCCs).</p>
                </div>

                <div class="privacy-section">
                    <h3>üìã 2. What Data We Collect &amp; Why (Lawful Basis)</h3>
                    <p>We collect only the minimum data required to deliver our educational services ("data minimisation" principle):</p>
                    <ul>
                        <li><strong>Parents:</strong> Email address, phone number, password (hashed by Firebase Auth), referral code/tracking data. <em>Lawful basis: Contract performance + Legitimate interest.</em></li>
                        <li><strong>Students (via parent):</strong> Full name, grade level, test scores, assignment responses, academic progress records. <em>Lawful basis: Parental consent + Contract performance.</em></li>
                        <li><strong>Tutors:</strong> Name, email, professional credentials, session logs. <em>Lawful basis: Contract performance.</em></li>
                        <li><strong>Technical Data:</strong> Login timestamps, device type, IP address (Firebase automatic). <em>Lawful basis: Legitimate interest (security).</em></li>
                        <li><strong>Analytics Cookies (optional):</strong> Page interaction metrics. <em>Lawful basis: Consent only.</em></li>
                    </ul>
                </div>

                <div class="privacy-section">
                    <h3>üîí 3. How We Protect Your Data</h3>
                    <ul>
                        <li>All data is encrypted in transit (TLS 1.2+) and at rest via Firebase/Google Cloud encryption.</li>
                        <li>Firestore Security Rules enforce role-based access ‚Äî tutors can only access their assigned students, parents can only access their own children's data.</li>
                        <li>Passwords are never stored in plain text; Firebase Authentication handles credential management.</li>
                        <li>No third-party marketing tools, advertising networks, or data brokers have access to your data.</li>
                        <li>Regular security audits and access reviews are conducted.</li>
                    </ul>
                </div>

                <div class="privacy-section">
                    <h3>üåç 4. International Data Transfers</h3>
                    <p>Your data is stored on Google Cloud servers (primarily in Belgium, EU). This constitutes an international data transfer from Nigeria. We rely on Google's Standard Contractual Clauses (SCCs) and adequacy decisions to ensure your data receives equivalent protection to Nigerian NDPA standards.</p>
                </div>

                <div class="privacy-section">
                    <h3>üë∂ 5. Children's Privacy (COPPA ‚Äî Under 13)</h3>
                    <p>We take the privacy of children extremely seriously:</p>
                    <ul>
                        <li>No personal data is collected directly from students. All student data is provided and managed by a registered parent/guardian.</li>
                        <li>For students under 13, we require verifiable parental consent before any academic data is processed.</li>
                        <li>Parents may review all data stored about their child, correct inaccuracies, or request permanent deletion at any time.</li>
                        <li>Student data is never used for advertising, profiling, or shared with any third party beyond the direct delivery of educational services.</li>
                        <li>If we discover that student data has been collected without proper parental consent, we will delete it immediately.</li>
                    </ul>
                </div>

                <div class="privacy-section">
                    <h3>üîó 6. Data Sharing &amp; Third Parties</h3>
                    <p>We do <strong>NOT</strong> sell, rent, or trade your personal data. Limited sharing occurs only with:</p>
                    <ul>
                        <li><strong>Google Firebase/Firestore:</strong> Infrastructure provider (Data Processing Agreement in place).</li>
                        <li><strong>Assigned Tutors:</strong> Access only to their specific assigned students' academic data.</li>
                        <li><strong>Legal Authorities:</strong> Only if required by Nigerian law, court order, or to protect safety.</li>
                    </ul>
                </div>

                <div class="privacy-section">
                    <h3>üç™ 7. Cookies &amp; Tracking</h3>
                    <ul>
                        <li><strong>Essential Cookies:</strong> Firebase authentication tokens (session management). Cannot be disabled ‚Äî required for the portal to function.</li>
                        <li><strong>Analytics Cookies (Optional):</strong> Page visit metrics to improve the platform. Requires your explicit consent.</li>
                        <li><strong>No advertising cookies</strong> or third-party tracking scripts are used.</li>
                    </ul>
                </div>

                <div class="privacy-section">
                    <h3>‚öñÔ∏è 8. Your Legal Rights</h3>
                    <p>Under the NDPA (Nigeria), GDPR (if applicable), and COPPA (for children), you have the right to:</p>
                    <ul>
                        <li><strong>Access:</strong> Request a complete copy of all data we hold about you and your children.</li>
                        <li><strong>Rectification:</strong> Correct any inaccurate or incomplete data.</li>
                        <li><strong>Erasure ("Right to be Forgotten"):</strong> Request permanent deletion of your account and all associated data.</li>
                        <li><strong>Portability:</strong> Receive your data in a structured, machine-readable format (JSON/CSV).</li>
                        <li><strong>Restriction:</strong> Request that we limit how we process your data while a dispute is resolved.</li>
                        <li><strong>Object:</strong> Object to processing based on legitimate interest.</li>
                        <li><strong>Withdraw Consent:</strong> Withdraw marketing/analytics consent at any time without affecting past lawful processing.</li>
                        <li><strong>Lodge a Complaint:</strong> File a complaint with the Nigeria Data Protection Commission (NDPC) at <a href="https://ndpc.gov.ng" target="_blank" style="color:#059669;">ndpc.gov.ng</a>.</li>
                    </ul>
                    <p>All rights requests are responded to within <strong>30 days</strong> as required by NDPA and GDPR.</p>
                </div>

                <div class="privacy-section">
                    <h3>üì¢ 9. Policy Updates &amp; Notifications</h3>
                    <p>We may update this Privacy Policy to reflect changes in law, technology, or our services. When we make material changes, we will notify you via email (registered on this portal) and display a prominent notice on the platform at least 14 days before changes take effect. Continued use of the platform after changes take effect constitutes acceptance.</p>
                </div>

                <div class="privacy-section">
                    <h3>üìû 10. Contact &amp; Complaints</h3>
                    <p>For any privacy-related concern, data rights request, or to contact our Data Protection Officer:</p>
                    <ul>
                        <li><strong>Email:</strong> <a href="/cdn-cgi/l/email-protection#5a33343c351a383635353733343d31333e2932352f293f74393537" style="color:#059669;"><span class="__cf_email__" data-cfemail="7d14131b123d1f1112121014131a1614190e1512080e18531e1210">[email&#160;protected]</span></a></li>
                        <li><strong>Regulatory Body:</strong> Nigeria Data Protection Commission ‚Äî <a href="https://ndpc.gov.ng" target="_blank" style="color:#059669;">ndpc.gov.ng</a></li>
                        <li><strong>Response Time:</strong> We aim to respond to all privacy inquiries within 72 hours.</li>
                    </ul>
                </div>
            </div>
            <div class="privacy-modal-footer">
                <span>¬© 2026 Blooming Kids House ¬∑ Privacy Policy v2.0</span>
                <a onclick="openDataRights()">Exercise My Rights ‚Üí</a>
            </div>
        </div>
    </div>

    <!-- ‚ë£ CONSENT PREFERENCES MODAL -->
    <div id="consentPreferencesModal" class="privacy-overlay hidden">
        <div class="privacy-modal" style="max-width:600px;">
            <div class="privacy-modal-header">
                <div>
                    <h2>‚öôÔ∏è Consent Preferences</h2>
                    <div style="font-size:0.8rem;opacity:0.85;margin-top:4px;">Control what data we collect and process</div>
                </div>
                <button class="privacy-close-btn" onclick="closeModal('consentPreferencesModal')">&times;</button>
            </div>
            <div class="privacy-modal-body">
                <p style="font-size:0.88rem;color:#4b5563;margin-bottom:20px;">Below you can manage your consent for each category of data processing. Essential processing cannot be disabled as it is required for the platform to function. Changes are saved immediately.</p>

                <div class="consent-toggle-row">
                    <div class="consent-toggle-info">
                        <h4>üîë Essential Processing</h4>
                        <p>Authentication, session management, Firestore security rules. Required for login and access to your children's reports.</p>
                    </div>
                    <label class="toggle-switch disabled-toggle">
                        <input type="checkbox" checked disabled>
                        <span class="toggle-slider"></span>
                    </label>
                </div>

                <div class="consent-toggle-row">
                    <div class="consent-toggle-info">
                        <h4>üìä Academic Progress Tracking</h4>
                        <p>Storing test scores, assignment results, and academic growth charts for your children's profiles.</p>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="consentAcademic" checked onchange="saveConsentPreference('academic', this.checked)">
                        <span class="toggle-slider"></span>
                    </label>
                </div>

                <div class="consent-toggle-row">
                    <div class="consent-toggle-info">
                        <h4>üì£ Referral &amp; Rewards Tracking</h4>
                        <p>Tracking referral codes and reward points for the Parent Referral Reward System.</p>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="consentReferral" checked onchange="saveConsentPreference('referral', this.checked)">
                        <span class="toggle-slider"></span>
                    </label>
                </div>

                <div class="consent-toggle-row">
                    <div class="consent-toggle-info">
                        <h4>üí¨ Communication &amp; Feedback</h4>
                        <p>Storing feedback messages, admin responses, and enabling two-way communication with tutors and management.</p>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="consentComms" checked onchange="saveConsentPreference('comms', this.checked)">
                        <span class="toggle-slider"></span>
                    </label>
                </div>

                <div class="consent-toggle-row">
                    <div class="consent-toggle-info">
                        <h4>üìß Email Notifications</h4>
                        <p>Receiving email alerts for new progress reports, admin responses, and important platform announcements.</p>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="consentEmail" checked onchange="saveConsentPreference('email', this.checked)">
                        <span class="toggle-slider"></span>
                    </label>
                </div>

                <div class="consent-toggle-row">
                    <div class="consent-toggle-info">
                        <h4>üìà Analytics &amp; Platform Improvement</h4>
                        <p>Anonymous usage data to help us understand how parents use the portal and improve the experience.</p>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="consentAnalytics" onchange="saveConsentPreference('analytics', this.checked)">
                        <span class="toggle-slider"></span>
                    </label>
                </div>

                <div style="margin-top:24px;display:flex;gap:12px;flex-wrap:wrap;">
                    <button onclick="acceptAllConsents()" style="flex:1;background:#059669;color:#fff;border:none;padding:12px;border-radius:10px;font-weight:700;cursor:pointer;min-width:140px;">‚úì Accept All</button>
                    <button onclick="saveAndCloseConsents()" style="flex:1;background:#ecfdf5;color:#065f46;border:1.5px solid #6ee7b7;padding:12px;border-radius:10px;font-weight:700;cursor:pointer;min-width:140px;">üíæ Save My Choices</button>
                    <button onclick="rejectAllOptional()" style="flex:1;background:#fef2f2;color:#dc2626;border:1.5px solid #fca5a5;padding:12px;border-radius:10px;font-weight:700;cursor:pointer;min-width:140px;">‚úó Essential Only</button>
                </div>

                <div id="consentSavedMsg" class="hidden" style="margin-top:14px;background:#ecfdf5;border:1.5px solid #6ee7b7;border-radius:10px;padding:12px;text-align:center;font-size:0.88rem;font-weight:600;color:#065f46;">
                    ‚úÖ Your consent preferences have been saved.
                </div>

                <div style="margin-top:20px;background:#fffbeb;border:1.5px solid #fde68a;border-radius:10px;padding:14px;font-size:0.82rem;color:#92400e;">
                    <strong>‚ö†Ô∏è Note:</strong> Disabling Academic Tracking or Communications may limit certain features of the portal. You can change these preferences at any time by returning to this menu.
                </div>
            </div>
            <div class="privacy-modal-footer">
                <span>Consent preferences are stored locally on your device.</span>
                <a onclick="openPrivacyPolicy()">View Full Policy ‚Üí</a>
            </div>
        </div>
    </div>

    <!-- ‚ë§ DATA RIGHTS MODAL -->
    <div id="dataRightsModal" class="privacy-overlay hidden">
        <div class="privacy-modal">
            <div class="privacy-modal-header">
                <div>
                    <h2>‚öñÔ∏è Exercise My Data Rights</h2>
                    <div style="font-size:0.8rem;opacity:0.85;margin-top:4px;">NDPA ¬∑ GDPR ¬∑ COPPA ‚Äî Responses within 30 days</div>
                </div>
                <button class="privacy-close-btn" onclick="closeModal('dataRightsModal')">&times;</button>
            </div>
            <div class="privacy-modal-body">
                <p style="font-size:0.88rem;color:#4b5563;margin-bottom:20px;">Under Nigerian and international data protection law, you have several rights regarding your personal data. Select your request type below and submit the form. Our Data Protection Officer will respond within <strong>30 days</strong>.</p>

                <div id="dataRightsForm">
                    <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:20px;" id="rightsTypeSelector">
                        <div class="rights-card selected" onclick="selectRightType(this,'access')" data-type="access">
                            <h4>üì• Right of Access</h4>
                            <p>Request a complete copy of all personal data we hold about you and your children.</p>
                        </div>
                        <div class="rights-card" onclick="selectRightType(this,'rectification')" data-type="rectification">
                            <h4>‚úèÔ∏è Right to Rectification</h4>
                            <p>Request correction of inaccurate or incomplete personal data.</p>
                        </div>
                        <div class="rights-card" onclick="selectRightType(this,'erasure')" data-type="erasure">
                            <h4>üóëÔ∏è Right to Erasure</h4>
                            <p>Request permanent deletion of your account and all associated data ("Right to be Forgotten").</p>
                        </div>
                        <div class="rights-card" onclick="selectRightType(this,'portability')" data-type="portability">
                            <h4>üì§ Right to Portability</h4>
                            <p>Receive your data in a structured, machine-readable format (JSON/CSV).</p>
                        </div>
                        <div class="rights-card" onclick="selectRightType(this,'restriction')" data-type="restriction">
                            <h4>‚è∏Ô∏è Right to Restriction</h4>
                            <p>Request that we pause processing of your data while a complaint is being investigated.</p>
                        </div>
                        <div class="rights-card" onclick="selectRightType(this,'objection')" data-type="objection">
                            <h4>‚úã Right to Object</h4>
                            <p>Object to processing of your personal data for specific purposes.</p>
                        </div>
                    </div>

                    <div style="background:#f0fdf4;border:1.5px solid #bbf7d0;border-radius:12px;padding:16px;margin-bottom:20px;" id="selectedRightInfo">
                        <strong style="color:#065f46;">üì• Right of Access:</strong>
                        <span style="font-size:0.87rem;color:#374151;"> We will compile a complete data export of all information linked to your account and email it to your registered address within 30 days.</span>
                    </div>

                    <div class="rights-form-group">
                        <label>Full Name *</label>
                        <input type="text" id="rightsFullName" placeholder="Your full name as registered">
                    </div>
                    <div class="rights-form-group">
                        <label>Registered Email Address *</label>
                        <input type="email" id="rightsEmail" placeholder="Email linked to your portal account">
                    </div>
                    <div class="rights-form-group">
                        <label>Proof of Identity</label>
                        <select id="rightsIdType">
                            <option value="">Select ID type (for verification)</option>
                            <option>Nigerian NIN (National Identification Number)</option>
                            <option>International Passport Number</option>
                            <option>Driver's Licence Number</option>
                            <option>Voter's Card Number</option>
                        </select>
                    </div>
                    <div class="rights-form-group">
                        <label>Additional Details / Reason for Request</label>
                        <textarea id="rightsDetails" rows="4" placeholder="Provide any additional context to help us process your request efficiently..."></textarea>
                    </div>

                    <div style="background:#fdf4ff;border:1.5px solid #c4b5fd;border-radius:10px;padding:14px;margin-bottom:16px;font-size:0.83rem;color:#4b5563;">
                        <strong style="color:#7c3aed;">üõ°Ô∏è COPPA ‚Äî Child Data:</strong> If your request concerns data about a student under 13, please mention the child's name and confirm your relationship as parent/legal guardian. We will process child data requests with the highest priority.
                    </div>

                    <div class="privacy-consent-check" style="margin-bottom:16px;">
                        <input type="checkbox" id="rightsConsentCheck">
                        <label for="rightsConsentCheck">I confirm that the information provided is accurate and I am authorised to make this data rights request. I understand this request may be verified against my registered account.</label>
                    </div>

                    <button class="rights-submit-btn" onclick="submitDataRightsRequest()">üì§ Submit Data Rights Request</button>
                </div>

                <div id="dataRightsSuccess" class="rights-success-box hidden">
                    <div class="check-icon">‚úÖ</div>
                    <h4>Request Submitted Successfully</h4>
                    <p>Your data rights request has been received. Our Data Protection Officer will review your request and respond to your registered email address within <strong>30 days</strong> as required by the NDPA and GDPR. A reference number has been generated for your records.</p>
                    <div id="rightsRefNumber" style="margin-top:12px;background:#fff;border:1.5px solid #6ee7b7;border-radius:8px;padding:10px;font-weight:700;color:#065f46;font-size:0.9rem;"></div>
                    <button onclick="resetDataRightsForm()" style="margin-top:16px;background:#059669;color:#fff;border:none;padding:10px 24px;border-radius:10px;font-weight:700;cursor:pointer;">Submit Another Request</button>
                </div>
            </div>
            <div class="privacy-modal-footer">
                <span>DPO: <a href="/cdn-cgi/l/email-protection#b8d1d6ded7f8dad4d7d7d5d1d6dfd3d1dccbd0d7cdcbdd96dbd7d5"><span class="__cf_email__" data-cfemail="6e070008012e0c0201010307000905070a1d06011b1d0b400d0103">[email&#160;protected]</span></a></span>
                <a href="https://ndpc.gov.ng" target="_blank">File Complaint with NDPC ‚Üí</a>
            </div>
        </div>
    </div>

    <!-- ‚ë• DATA RETENTION MODAL -->
    <div id="dataRetentionModal" class="privacy-overlay hidden">
        <div class="privacy-modal" style="max-width:640px;">
            <div class="privacy-modal-header">
                <div>
                    <h2>üìÖ Data Retention Schedule</h2>
                    <div style="font-size:0.8rem;opacity:0.85;margin-top:4px;">How long we store each category of personal data</div>
                </div>
                <button class="privacy-close-btn" onclick="closeModal('dataRetentionModal')">&times;</button>
            </div>
            <div class="privacy-modal-body">
                <p style="font-size:0.88rem;color:#4b5563;margin-bottom:20px;">We retain personal data only for as long as necessary to fulfil the purpose it was collected for, or as required by Nigerian law and applicable international regulations.</p>

                <table class="retention-table">
                    <thead>
                        <tr>
                            <th>Data Category</th>
                            <th>Retention Period</th>
                            <th>Legal Basis</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td><strong>Parent Account &amp; Login Data</strong></td><td>Duration of account + 2 years</td><td>Contract / NDPA Art. 24</td></tr>
                        <tr><td><strong>Student Academic Records</strong></td><td>Duration of enrolment + 3 years</td><td>Educational records law</td></tr>
                        <tr><td><strong>Progress Report PDFs</strong></td><td>Duration of enrolment + 5 years</td><td>Legitimate interest</td></tr>
                        <tr><td><strong>Feedback &amp; Messages</strong></td><td>2 years from submission</td><td>Legitimate interest</td></tr>
                        <tr><td><strong>Referral &amp; Rewards Data</strong></td><td>3 years from last activity</td><td>Contract performance</td></tr>
                        <tr><td><strong>Authentication Logs</strong></td><td>90 days</td><td>Security / Fraud prevention</td></tr>
                        <tr><td><strong>Analytics Data (if consented)</strong></td><td>13 months (Google standard)</td><td>Consent</td></tr>
                        <tr><td><strong>Data Rights Requests</strong></td><td>6 years</td><td>Legal compliance / NDPA</td></tr>
                        <tr><td><strong>Deleted Account Data</strong></td><td>30 days (recovery window), then purged</td><td>Erasure right / NDPA</td></tr>
                    </tbody>
                </table>

                <div class="privacy-section" style="margin-top:24px;">
                    <h3>üóëÔ∏è Automatic Deletion</h3>
                    <p>When your account is deleted (via request or inactivity), our automated system initiates a data purge process. All personally identifiable information is removed from Firestore within 30 days. Anonymised statistical data (e.g., aggregated test score averages) may be retained indefinitely as it cannot be linked back to any individual.</p>
                </div>

                <div class="privacy-section">
                    <h3>üì¶ Data Backups</h3>
                    <p>Google Firebase maintains automated backups for disaster recovery. Backup data follows the same retention schedule above. Backup data is encrypted and access-controlled, and will be purged in sync with the primary deletion within the same 30-day window.</p>
                </div>

                <button onclick="openDataRights()" style="width:100%;background:#059669;color:#fff;border:none;padding:12px;border-radius:12px;font-weight:700;font-size:0.95rem;cursor:pointer;margin-top:8px;">‚öñÔ∏è Request Early Deletion of My Data</button>
            </div>
            <div class="privacy-modal-footer">
                <span>Last reviewed: February 24, 2026</span>
                <a onclick="openPrivacyPolicy()">Full Privacy Policy ‚Üí</a>
            </div>
        </div>
    </div>

    <!-- ================================================================
         PRIVACY SYSTEM JAVASCRIPT
         ================================================================ -->
    <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
    // ‚îÄ‚îÄ‚îÄ State ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    const PRIVACY_KEY = 'bkh_privacy_consent_v2';
    let selectedRightType = 'access';

    const rightDescriptions = {
        access:        'üì• <strong>Right of Access:</strong> We will compile a complete data export of all information linked to your account and email it to your registered address within 30 days.',
        rectification: '‚úèÔ∏è <strong>Right to Rectification:</strong> Tell us which data is incorrect. We will review and correct it within 30 days and confirm the changes.',
        erasure:       'üóëÔ∏è <strong>Right to Erasure:</strong> We will permanently delete your account and all associated data within 30 days. This action is irreversible. Your children\'s academic records will also be removed.',
        portability:   'üì§ <strong>Right to Portability:</strong> We will prepare a machine-readable export (JSON/CSV) of all your data and your children\'s academic records within 30 days.',
        restriction:   '‚è∏Ô∏è <strong>Right to Restriction:</strong> We will pause all non-essential processing of your data while your request is under review. You will still be able to log in.',
        objection:     '‚úã <strong>Right to Object:</strong> Tell us which processing activities you object to. We will review our legal basis and either stop the processing or explain why we must continue.',
    };

    // ‚îÄ‚îÄ‚îÄ Initialisation ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    document.addEventListener('DOMContentLoaded', function () {
        const saved = getSavedConsent();
        if (!saved || !saved.bannerSeen) {
            setTimeout(() => {
                document.getElementById('privacyConsentBanner').classList.remove('hidden');
            }, 1200);
        }
        // Load saved toggle states
        if (saved && saved.preferences) {
            const prefs = saved.preferences;
            ['academic','referral','comms','email','analytics'].forEach(k => {
                const el = document.getElementById('consent' + k.charAt(0).toUpperCase() + k.slice(1));
                if (el && prefs[k] !== undefined) el.checked = prefs[k];
            });
        }
        // Validate sign-up consent before account creation
        hookSignUpConsent();
    });

    // ‚îÄ‚îÄ‚îÄ Storage Helpers ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function getSavedConsent() {
        try { return JSON.parse(localStorage.getItem(PRIVACY_KEY)); } catch(e) { return null; }
    }
    function saveConsent(obj) {
        try { localStorage.setItem(PRIVACY_KEY, JSON.stringify(obj)); } catch(e) {}
    }

    // ‚îÄ‚îÄ‚îÄ Banner Actions ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function acceptAllCookies() {
        saveConsent({ bannerSeen: true, preferences: { academic:true, referral:true, comms:true, email:true, analytics:true }, timestamp: new Date().toISOString(), version:'2.0' });
        hideBanner();
        showPrivacyToast('‚úÖ All preferences accepted. Thank you!', 'success');
    }
    function rejectOptionalCookies() {
        saveConsent({ bannerSeen: true, preferences: { academic:true, referral:true, comms:true, email:false, analytics:false }, timestamp: new Date().toISOString(), version:'2.0' });
        hideBanner();
        // Update toggles
        const emailEl = document.getElementById('consentEmail');
        const analyticsEl = document.getElementById('consentAnalytics');
        if (emailEl) emailEl.checked = false;
        if (analyticsEl) analyticsEl.checked = false;
        showPrivacyToast('üîí Essential processing only. Analytics disabled.', 'info');
    }
    function hideBanner() {
        const banner = document.getElementById('privacyConsentBanner');
        banner.style.animation = 'none';
        banner.style.transform = 'translateY(100%)';
        banner.style.opacity = '0';
        banner.style.transition = 'all 0.35s ease';
        setTimeout(() => banner.classList.add('hidden'), 350);
    }

    // ‚îÄ‚îÄ‚îÄ Modal Controls ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function openPrivacyHub()            { openModal('privacyHubModal'); }
    function openPrivacyPolicy()         { closeAllModals(); openModal('privacyPolicyModal'); }
    function openConsentPreferences()    { closeAllModals(); hideBanner(); openModal('consentPreferencesModal'); }
    function openDataRights()            { closeAllModals(); openModal('dataRightsModal'); }
    function openDataRetention()         { closeAllModals(); openModal('dataRetentionModal'); }

    function openModal(id) {
        document.getElementById(id).classList.remove('hidden');
        document.body.style.overflow = 'hidden';
    }
    function closeModal(id) {
        document.getElementById(id).classList.add('hidden');
        document.body.style.overflow = '';
    }
    function closeAllModals() {
        ['privacyHubModal','privacyPolicyModal','consentPreferencesModal','dataRightsModal','dataRetentionModal'].forEach(closeModal);
    }

    // Close modals when clicking overlay background
    document.querySelectorAll('.privacy-overlay').forEach(overlay => {
        overlay.addEventListener('click', function(e) {
            if (e.target === this) {
                this.classList.add('hidden');
                document.body.style.overflow = '';
            }
        });
    });

    // ‚îÄ‚îÄ‚îÄ Consent Preferences ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function saveConsentPreference(key, value) {
        const saved = getSavedConsent() || { bannerSeen: true, preferences: {} };
        saved.preferences[key] = value;
        saved.timestamp = new Date().toISOString();
        saveConsent(saved);
    }
    function acceptAllConsents() {
        ['academic','referral','comms','email','analytics'].forEach(k => {
            const el = document.getElementById('consent' + k.charAt(0).toUpperCase() + k.slice(1));
            if (el) { el.checked = true; saveConsentPreference(k, true); }
        });
        showConsentSavedMsg();
    }
    function rejectAllOptional() {
        ['email','analytics'].forEach(k => {
            const el = document.getElementById('consent' + k.charAt(0).toUpperCase() + k.slice(1));
            if (el) { el.checked = false; saveConsentPreference(k, false); }
        });
        showConsentSavedMsg();
    }
    function saveAndCloseConsents() {
        const saved = getSavedConsent() || { preferences: {} };
        saved.bannerSeen = true;
        saved.timestamp = new Date().toISOString();
        saved.version = '2.0';
        saveConsent(saved);
        hideBanner();
        showConsentSavedMsg();
        setTimeout(() => closeModal('consentPreferencesModal'), 1800);
    }
    function showConsentSavedMsg() {
        const msg = document.getElementById('consentSavedMsg');
        if (!msg) return;
        msg.classList.remove('hidden');
        setTimeout(() => msg.classList.add('hidden'), 3000);
    }

    // ‚îÄ‚îÄ‚îÄ Data Rights ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function selectRightType(card, type) {
        document.querySelectorAll('#rightsTypeSelector .rights-card').forEach(c => c.classList.remove('selected'));
        card.classList.add('selected');
        selectedRightType = type;
        const infoEl = document.getElementById('selectedRightInfo');
        if (infoEl) infoEl.innerHTML = '<strong style="color:#065f46;">' + rightDescriptions[type] + '</strong>';
    }

    function submitDataRightsRequest() {
        const name    = document.getElementById('rightsFullName').value.trim();
        const email   = document.getElementById('rightsEmail').value.trim();
        const consent = document.getElementById('rightsConsentCheck').checked;

        if (!name || !email) {
            showPrivacyToast('‚ö†Ô∏è Please provide your full name and email address.', 'warning');
            return;
        }
        if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
            showPrivacyToast('‚ö†Ô∏è Please enter a valid email address.', 'warning');
            return;
        }
        if (!consent) {
            showPrivacyToast('‚ö†Ô∏è Please confirm the declaration checkbox.', 'warning');
            return;
        }

        // Generate reference number
        const ref = 'BKH-DR-' + Date.now().toString(36).toUpperCase() + '-' + Math.random().toString(36).substr(2,4).toUpperCase();
        const timestamp = new Date().toLocaleString('en-NG', { timeZone: 'Africa/Lagos' });

        // Store request locally
        const requests = JSON.parse(localStorage.getItem('bkh_rights_requests') || '[]');
        requests.push({ ref, type: selectedRightType, name, email, timestamp });
        localStorage.setItem('bkh_rights_requests', JSON.stringify(requests));

        document.getElementById('dataRightsForm').classList.add('hidden');
        document.getElementById('dataRightsSuccess').classList.remove('hidden');
        document.getElementById('rightsRefNumber').textContent = 'üîñ Reference: ' + ref + ' | Submitted: ' + timestamp;

        showPrivacyToast('‚úÖ Data rights request submitted successfully!', 'success');
    }

    function resetDataRightsForm() {
        document.getElementById('dataRightsForm').classList.remove('hidden');
        document.getElementById('dataRightsSuccess').classList.add('hidden');
        document.getElementById('rightsFullName').value = '';
        document.getElementById('rightsEmail').value = '';
        document.getElementById('rightsDetails').value = '';
        document.getElementById('rightsConsentCheck').checked = false;
        document.getElementById('rightsIdType').value = '';
        document.querySelectorAll('#rightsTypeSelector .rights-card').forEach((c,i) => {
            c.classList.toggle('selected', i === 0);
        });
        selectedRightType = 'access';
        document.getElementById('selectedRightInfo').innerHTML = '<strong style="color:#065f46;">' + rightDescriptions.access + '</strong>';
    }

    // ‚îÄ‚îÄ‚îÄ Sign-Up Consent Hook ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function hookSignUpConsent() {
        const signUpBtn = document.getElementById('signUpBtn');
        if (!signUpBtn) return;
        signUpBtn.addEventListener('click', function(e) {
            const check = document.getElementById('privacyConsentCheck');
            if (check && !check.checked) {
                e.stopImmediatePropagation();
                e.preventDefault();
                showPrivacyToast('‚ö†Ô∏è You must agree to the Privacy Policy and Data Processing Terms to create an account.', 'warning');
                check.closest('.privacy-consent-check').style.animation = 'none';
                check.closest('.privacy-consent-check').style.borderColor = '#ef4444';
                check.closest('.privacy-consent-check').style.background = '#fef2f2';
                setTimeout(() => {
                    check.closest('.privacy-consent-check').style.borderColor = '#bbf7d0';
                    check.closest('.privacy-consent-check').style.background = '#f0fdf4';
                }, 2500);
                return false;
            }
        }, true); // capture phase so it fires before parent.js handlers
    }

    // ‚îÄ‚îÄ‚îÄ Toast Helper ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function showPrivacyToast(message, type = 'success') {
        // Reuse portal's existing toast if available
        if (typeof showToast === 'function') {
            showToast(message, type === 'info' ? 'warning' : type);
            return;
        }
        // Fallback
        const t = document.create
