<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Student Report - Blooming Kids House</title>
  <link rel="icon" href="favicon.ico" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>
<body class="bg-gray-100 font-sans">

  <div class="max-w-4xl mx-auto py-10 px-4">
    <div class="bg-white shadow-md rounded-xl p-6" id="reportContainer">

      <h1 class="text-2xl font-bold text-center text-green-700 mb-4">BLOOMING KIDS HOUSE ASSESSMENT REPORT</h1>

      <div class="grid grid-cols-2 gap-4 mb-6">
        <p><strong>Student Name:</strong> <span id="studentName"></span></p>
        <p><strong>Grade:</strong> <span id="grade"></span></p>
        <p><strong>Parent Email:</strong> <span id="parentEmail"></span></p>
        <p><strong>Location:</strong> <span id="location"></span></p>
        <p><strong>Tutor:</strong> <span id="tutor"></span></p>
      </div>

      <div id="subjectReports" class="space-y-6"></div>

      <div class="mt-6">
        <h2 class="text-lg font-semibold text-green-700 mb-2">Directorâ€™s Message</h2>
        <p>
          Dear Parent,<br><br>
          Thank you for allowing your child to participate in the Blooming Kids House Assessment. This report reflects your child's current academic strengths and areas that need attention. 
          We believe every child is unique and capable of greatness with the right guidance. Your child's tutor, <span id="tutorNameFooter" class="font-bold"></span>, is committed to working closely with you to help your child improve in the necessary areas and shine brightly. <br><br>
          Best regards,<br>
          <strong>Mrs. Oluwakemi Oladunjoye</strong><br>
          Director, Blooming Kids House
        </p>
      </div>

      <footer class="text-center text-sm text-gray-600 mt-10">
        POWERED BY <span style="color:#FFEB3B">POG</span>
      </footer>
    </div>

    <div class="text-center mt-6">
      <button id="downloadBtn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-6 rounded">
        Download PDF
      </button>
    </div>
  </div>

  <script>
    const reportData = JSON.parse(localStorage.getItem("reportData") || "{}");

    document.getElementById("studentName").innerText = reportData.studentName || "";
    document.getElementById("grade").innerText = reportData.grade || "";
    document.getElementById("parentEmail").innerText = reportData.parentEmail || "";
    document.getElementById("location").innerText = reportData.location || "";
    document.getElementById("tutor").innerText = reportData.tutorName || "";
    document.getElementById("tutorNameFooter").innerText = reportData.tutorName || "";

    const subjectReportsContainer = document.getElementById("subjectReports");

    if (reportData.subjects) {
      Object.entries(reportData.subjects).forEach(([subject, data]) => {
        const subjectDiv = document.createElement("div");
        subjectDiv.classList.add("bg-gray-50", "p-4", "rounded", "shadow");

        subjectDiv.innerHTML = `
          <h3 class="text-green-700 font-semibold text-lg mb-2">${subject}</h3>
          <table class="table-auto w-full text-sm mb-3">
            <thead>
              <tr class="bg-green-100">
                <th class="px-2 py-1 text-left">Knowledge Area</th>
                <th class="px-2 py-1 text-left">Score</th>
              </tr>
            </thead>
            <tbody>
              ${Object.entries(data.knowledge || {}).map(([k, v]) => `
                <tr>
                  <td class="border px-2 py-1">${k}</td>
                  <td class="border px-2 py-1">${v}</td>
                </tr>`).join("")}
            </tbody>
          </table>
          <table class="table-auto w-full text-sm">
            <thead>
              <tr class="bg-yellow-100">
                <th class="px-2 py-1 text-left">Skill</th>
                <th class="px-2 py-1 text-left">Score</th>
              </tr>
            </thead>
            <tbody>
              ${Object.entries(data.skills || {}).map(([k, v]) => `
                <tr>
                  <td class="border px-2 py-1">${k}</td>
                  <td class="border px-2 py-1">${v}</td>
                </tr>`).join("")}
            </tbody>
          </table>
        `;

        subjectReportsContainer.appendChild(subjectDiv);
      });
    }

    document.getElementById("downloadBtn").addEventListener("click", () => {
      const element = document.getElementById("reportContainer");
      const opt = {
        margin: 0.3,
        filename: `${reportData.studentName || 'report'}-Assessment-Report.pdf`,
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 2 },
        jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
      };
      html2pdf().set(opt).from(element).save();
    });
  </script>

</body>
</html>
