<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tutor Portal - Blooming Kids House</title>
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- FIXED: Use CDN instead of local file -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/material-design-iconic-font/2.2.0/css/material-design-iconic-font.min.css">
   
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-NBTVEGH1SL"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-NBTVEGH1SL');
    </script>

    <style>
        /* Custom Styles for Nav Buttons */
        .nav-btn {
            padding: 8px 16px;
            border-bottom: 2px solid transparent;
            transition: all 0.3s ease;
            white-space: nowrap;
        }
        .nav-btn.active {
            border-bottom-color: #16a34a;
            color: #16a34a;
        }
        
        /* FIXED: Use gradient background instead of missing image */
        .wrapper {
            padding: 10px 0;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
            background-size: cover;
            background-position: center;
            transition: background-color 0.3s;
        }
        .inner {
            max-width: 1280px; 
            width: 95%; 
            padding: 20px;
            background: #ffffff;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
            min-height: 80vh;
            transition: background-color 0.3s, color 0.3s;
            margin: 10px 0;
        }
        
        .dashboard-header {
            color: #333;
            text-shadow: none;
            transition: color 0.3s;
        }

        /* Network Error Overlay */
        #networkErrorOverlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 10000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }

        .error-content {
            background: white;
            padding: 3rem;
            border-radius: 15px;
            text-align: center;
            max-width: 500px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            animation: fadeIn 0.5s ease-out;
        }

        .dark .error-content {
            background: #1f2937;
            color: white;
        }

        .error-icon {
            font-size: 4rem;
            color: #f59e0b;
            margin-bottom: 1rem;
        }

        .error-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 2rem;
            flex-wrap: wrap;
        }

        .error-btn {
            padding: 12px 24px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
        }

        .error-btn.primary {
            background: #16a34a;
            color: white;
        }

        .error-btn.secondary {
            background: #f59e0b;
            color: white;
        }

        .error-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Network Warning Banner */
        #networkWarning {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: #fef3cd;
            border-bottom: 2px solid #f59e0b;
            padding: 12px 20px;
            text-align: center;
            z-index: 9999;
            font-weight: 500;
        }

        .dark #networkWarning {
            background: #78350f;
            border-bottom-color: #f59e0b;
            color: white;
        }

        #networkWarning .close-btn {
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            margin-left: 15px;
            padding: 5px 10px;
            border-radius: 3px;
        }

        .dark #networkWarning .close-btn {
            color: white;
        }

        /* Mobile-first responsive design */
        @media (max-width: 768px) {
            .wrapper {
                padding: 5px 0;
            }
            .inner {
                width: 98%;
                padding: 15px;
                margin: 5px 0;
            }
            
            .header-container {
                flex-direction: column;
                align-items: flex-start !important;
                gap: 15px;
            }
            
            .logo-title-container {
                flex-direction: column;
                align-items: flex-start !important;
                text-align: left;
                width: 100%;
            }
            
            .action-buttons {
                width: 100%;
                justify-content: space-between;
                gap: 10px;
            }
            
            .action-buttons .btn-mobile {
                flex: 1;
                min-width: 0;
                padding: 10px 8px;
                font-size: 0.875rem;
            }
            
            #tutorNameHeading {
                font-size: 1.5rem;
                margin-top: 10px;
            }
            
            #logoImg {
                height: 50px !important;
            }
            
            .nav-container {
                overflow-x: auto;
                padding-bottom: 5px;
            }
            
            .nav-buttons {
                display: flex;
                min-width: max-content;
                gap: 10px;
            }
            
            .nav-btn {
                padding: 8px 12px;
                font-size: 1rem;
            }

            .error-content {
                margin: 20px;
                padding: 2rem;
            }

            .error-buttons {
                flex-direction: column;
            }

            .error-btn {
                width: 100%;
            }
        }

        @media (max-width: 480px) {
            .inner {
                padding: 12px;
                border-radius: 8px;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .action-buttons .btn-mobile {
                width: 100%;
            }
            
            #tutorNameHeading {
                font-size: 1.25rem;
            }
            
            .nav-btn {
                padding: 6px 10px;
                font-size: 0.9rem;
            }

            .error-content {
                padding: 1.5rem;
                margin: 15px;
            }
        }

        /* Dark Mode Styles */
        .dark .wrapper {
            background: linear-gradient(135deg, #1e3a8a 0%, #7e22ce 100%) !important;
        }

        .dark #logoImg {
            filter: brightness(2) drop-shadow(0 0 5px rgba(255, 255, 255, 0.5));
        }

        .dark .inner {
            background: #1f2937;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);
        }
        
        .dark .inner, 
        .dark .inner p, 
        .dark .inner span, 
        .dark .inner a, 
        .dark .inner label, 
        .dark .inner div, 
        .dark .inner button,
        .dark .inner input,
        .dark .inner select,
        .dark .inner textarea,
        .dark .inner h1, .dark .inner h2, .dark .inner h3 {
             color: #ffffff !important;
        }
        
        .dark .inner input::placeholder,
        .dark .inner textarea::placeholder {
            color: #cccccc !important;
            opacity: 1 !important;
        }
        
        .dark .inner input:not([type="checkbox"]):not([type="radio"]),
        .dark .inner select,
        .dark .inner textarea {
            background-color: #374151 !important;
            border-color: #4b5563 !important;
            color: #ffffff !important;
        }
        
        .dark .inner table, 
        .dark .inner .bg-white {
            background-color: #374151 !important;
            color: #ffffff !important;
        }
        
        .dark .inner table td, 
        .dark .inner table th {
            border-color: #4b5563 !important;
            color: #ffffff !important;
        }
        
        .dark .inner .bg-gray-50 {
            background-color: #374151 !important;
        }
        
        .dark .inner button:focus,
        .dark .inner input:focus,
        .dark .inner select:focus {
            outline: 2px solid #3b82f6 !important;
            outline-offset: 2px !important;
        }
        
        .inner * {
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }

        .dark .dashboard-header {
            color: #ffffff !important;
        }
        
        .dark .nav-btn {
            color: #e5e7eb !important;
        }
        .dark .nav-btn.active {
            border-bottom-color: #10b981 !important;
            color: #10b981 !important;
        }
        .dark #logoutBtn, .dark #whatsappBtn {
             filter: brightness(1.2);
        }

        /* Hide scrollbar for nav */
        .nav-container::-webkit-scrollbar {
            display: none;
        }
        .nav-container {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>
<body>

    <!-- Network Error Overlay -->
    <div id="networkErrorOverlay">
        <div class="error-content">
            <div class="error-icon">
                <i class="fas fa-wifi"></i>
            </div>
            <h2 class="text-2xl font-bold mb-4">Connection Issue</h2>
            <p class="text-lg mb-2" id="errorMessage">We're having trouble connecting to the server.</p>
            <p class="text-gray-600 dark:text-gray-300 mb-6">This might be due to network problems or temporary server issues.</p>
            <div class="error-buttons">
                <button onclick="window.location.reload()" class="error-btn primary">
                    <i class="fas fa-redo mr-2"></i>Try Again
                </button>
                <button onclick="checkConnectivity()" class="error-btn secondary">
                    <i class="fas fa-network-wired mr-2"></i>Check Connection
                </button>
            </div>
        </div>
    </div>

    <!-- Network Warning Banner -->
    <div id="networkWarning">
        <span id="warningMessage">You appear to be offline. Some features may not work properly.</span>
        <button class="close-btn" onclick="hideNetworkWarning()">×</button>
    </div>

    <div class="wrapper">
        <div class="inner">
            <div class="max-w-7xl mx-auto">
                <!-- Header -->
                <div class="flex justify-between items-center mb-6 header-container">
                    <div class="flex items-center logo-title-container">
                        <img id="logoImg" src="https://res.cloudinary.com/dy2hxcyaf/image/upload/v1757700806/newbhlogo_umwqzy.svg" alt="Blooming Kids House Logo" class="h-16 w-auto mr-4 mobile-logo" style="filter: drop-shadow(0 0 5px rgba(0, 0, 0, 0.2));">
                        
                        <h1 id="tutorNameHeading" class="text-3xl font-bold dashboard-header mobile-title">Welcome, Tutor!</h1>
                    </div>
                    
                    <div class="flex space-x-3 items-center action-buttons">
                        <button id="modeToggle" class="p-3 rounded-full bg-gray-200 hover:bg-gray-300 text-gray-700 dark:bg-gray-600 dark:hover:bg-gray-700 dark:text-white transition-colors duration-300 shadow-md btn-mobile" aria-label="Toggle dark mode">
                            <i class="fas fa-moon" id="modeIcon"></i>
                        </button>

                        <a id="whatsappBtn" 
                           href="https://wa.me/2348158768689" 
                           target="_blank" 
                           class="bg-green-500 text-white px-4 py-2 rounded flex items-center hover:bg-green-600 shadow-md transition-colors duration-300 btn-mobile"
                           title="Contact Tech Support via WhatsApp">
                            <i class="fab fa-whatsapp mr-2 text-lg"></i> 
                            <span class="mobile-text">Tech Support</span>
                        </a>

                        <button id="logoutBtn" class="bg-yellow-400 text-white px-4 py-2 rounded hover:bg-yellow-500 shadow-md btn-mobile">
                            <span class="mobile-text">Logout</span>
                        </button>
                    </div>
                </div>
                
                <!-- Navigation - FIXED: Added Transition Students button -->
                <nav class="mb-6 border-b border-gray-200 dark:border-gray-700 nav-container">
                    <div class="flex space-x-4 nav-buttons">
                        <button id="navDashboard" class="nav-btn text-lg font-semibold active dashboard-header">Dashboard</button>
                        <button id="navStudentDatabase" class="nav-btn text-lg font-semibold text-gray-500 hover:text-green-600">Student Database</button>
                        <!-- NEW: Transition Students Button -->
                        <button id="navTransitionStudents" class="nav-btn text-lg font-semibold text-gray-500 hover:text-orange-600">Transition Students</button>
                    </div>
                </nav>

                <div id="mainContent">
                    <p class="text-center text-gray-600 mt-12 mobile-content">Checking user permissions...</p>
                </div>
            </div>
        </div>
    </div>
    
    <script type="module" src="tutor.js"></script>

    <script>
        // FIXED: Safe event listener initialization
        document.addEventListener('DOMContentLoaded', () => {
            const body = document.body;
            const toggleButton = document.getElementById('modeToggle');
            const modeIcon = document.getElementById('modeIcon');
            const modeKey = 'tutor_theme';

            // Function to set the theme
            const setTheme = (theme) => {
                if (theme === 'dark') {
                    body.classList.add('dark');
                    modeIcon.classList.remove('fa-moon');
                    modeIcon.classList.add('fa-sun');
                    localStorage.setItem(modeKey, 'dark');
                } else {
                    body.classList.remove('dark');
                    modeIcon.classList.remove('fa-sun');
                    modeIcon.classList.add('fa-moon');
                    localStorage.setItem(modeKey, 'light');
                }
            };

            // Load saved theme or default to light
            const savedTheme = localStorage.getItem(modeKey);
            if (savedTheme) {
                setTheme(savedTheme);
            } else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                setTheme('dark');
            } else {
                setTheme('light');
            }

            // Add event listener to toggle theme
            if (toggleButton) {
                toggleButton.addEventListener('click', () => {
                    const currentTheme = body.classList.contains('dark') ? 'dark' : 'light';
                    const newTheme = currentTheme === 'light' ? 'dark' : 'light';
                    setTheme(newTheme);
                });
            }

            // Mobile-specific enhancements
            function handleResize() {
                const isMobile = window.innerWidth < 768;
                
                if (isMobile) {
                    document.body.classList.add('mobile-view');
                    document.body.classList.remove('desktop-view');
                } else {
                    document.body.classList.add('desktop-view');
                    document.body.classList.remove('mobile-view');
                }
            }

            // Initial check
            handleResize();
            window.addEventListener('resize', handleResize);

            // Initialize Network Monitoring
            initializeNetworkMonitoring();
        });

        // Rest of your network monitoring code remains the same...
        function initializeNetworkMonitoring() {
            console.log('Network monitoring initialized');
            // ... keep the rest of your network monitoring code
        }

        // ... rest of your existing JavaScript code
    </script>
</body>
</html>
