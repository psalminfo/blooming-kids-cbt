<script type="module">
    // Corrected import paths
    import { loadQuestions } from './autoQuestionGen.js';
    import { submitTestToFirebase } from './submitAnswers.js';

    const urlParams = new URLSearchParams(window.location.search);
    const subject = urlParams.get('subject');
    const grade = urlParams.get('grade');
    const studentName = urlParams.get('studentName');
    const parentEmail = urlParams.get('parentEmail');
    const tutorEmail = urlParams.get('tutorEmail');
    const studentCountry = urlParams.get('country');
    const state = urlParams.get('state') || (subject === 'ela' ? 'creative-writing' : 'mcq');

    if (!subject || !grade || !studentName || !parentEmail || !tutorEmail || !studentCountry) {
        alert("Missing student info. Redirecting...");
        window.location.href = "index.html";
    } else {
        loadQuestions(subject, grade, state);
    }

    document.getElementById("submit-test-btn").addEventListener('click', async () => {
        await submitTestToFirebase(subject, grade, studentName, parentEmail, tutorEmail, studentCountry);
        document.getElementById("question-container").innerHTML = `<div class="text-center p-6 text-green-700 font-semibold text-xl">âœ… Submitted. Redirecting...</div>`;
        setTimeout(() => window.location.href = "subject-select.html", 1500);
    });

    window.logout = () => {
        localStorage.clear();
        window.location.href = 'index.html';
    };
</script>
